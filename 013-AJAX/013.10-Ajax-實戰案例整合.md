---
title: ğŸ§ª 013.10-Ajax-å¯¦æˆ°æ¡ˆä¾‹æ•´åˆ
tags:
  - AJAX
  - JSON
  - è¡¨å–®é€å‡º
  - Fetch API
  - jQuery
  - ASP.NET-Core
  - CORS
aliases:
  - Ajax æ•´åˆç·´ç¿’
  - Ajax å…¨æµç¨‹å¯¦ä½œ
  - Ajax èˆ‡ API ç¯„ä¾‹
created: 2025-07-21
updated: 2025-07-21
status: å®Œæˆ
summary: æœ¬ç¯‡ç­†è¨˜é€éä¸€å€‹ç°¡æ˜“ã€Œç•™è¨€ç³»çµ±ã€æ¡ˆä¾‹ï¼Œæ•´åˆ AJAX æŠ€è¡“èˆ‡ ASP.NET Core Web APIï¼Œå¯¦ä½œåŒ…å«è³‡æ–™è¼‰å…¥ã€JSON å‚³è¼¸ã€è¡¨å–®æäº¤ã€éŒ¯èª¤è™•ç†èˆ‡ CORS è¨­å®šï¼Œå¹«åŠ©è®€è€…å¯¦éš›æ“ä½œèˆ‡ç†è§£ AJAX æŠ€è¡“çš„å®Œæ•´æµç¨‹ã€‚
---

## ğŸ¯ ç›®æ¨™èˆ‡æƒ…å¢ƒ

- å»ºç«‹ä¸€å€‹ã€Œç•™è¨€ç³»çµ±ã€ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š
  1. å–å¾—æ‰€æœ‰ç•™è¨€
  2. æ–°å¢ç•™è¨€ï¼ˆè¡¨å–®é€å‡ºï¼‰
  3. å‰ç«¯é€é AJAX èˆ‡å¾Œç«¯ API æºé€š
  4. å›æ‡‰ JSON æ ¼å¼è³‡æ–™
  5. éŒ¯èª¤è™•ç†èˆ‡è·¨ä¾†æºè«‹æ±‚è™•ç†

---

## ğŸ§± 1. å¾Œç«¯ API è¨­è¨ˆï¼ˆASP.NET Coreï¼‰

### âœ… Model é¡åˆ¥

```csharp
public class Comment
{
    public int Id { get; set; }
    public string Author { get; set; }
    public string Content { get; set; }
    public DateTime CreatedAt { get; set; }
}
```

### âœ… Controller

```csharp
[ApiController]
[Route("api/comments")]
public class CommentsController : ControllerBase
{
    private static List<Comment> _comments = new();

    [HttpGet]
    public IActionResult GetAll() => Ok(_comments);

    [HttpPost]
    public IActionResult Post([FromBody] Comment comment)
    {
        if (string.IsNullOrWhiteSpace(comment.Author))
            return BadRequest("ä½œè€…ç‚ºå¿…å¡«");

        comment.Id = _comments.Count + 1;
        comment.CreatedAt = DateTime.Now;
        _comments.Add(comment);
        return Created("", comment);
    }
}
```

### âœ… å•Ÿç”¨ CORS

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowFrontend", policy =>
    {
        policy.WithOrigins("http://localhost:3000")
              .AllowAnyHeader()
              .AllowAnyMethod();
    });
});

app.UseCors("AllowFrontend");

```

---
## ğŸ’» 2. å‰ç«¯ HTML + JavaScript (ä½¿ç”¨ Fetch)

### HTML è¡¨å–®èˆ‡é¡¯ç¤ºå€å¡Š

```html
<form id="commentForm">
  <input type="text" id="author" placeholder="å§“å" required />
  <textarea id="content" placeholder="ç•™è¨€å…§å®¹" required></textarea>
  <button type="submit">é€å‡º</button>
</form>

<ul id="commentList"></ul>
```

### JavaScript æ“ä½œ

```javascript
const apiUrl = "http://localhost:5000/api/comments";

async function loadComments() {
  const res = await fetch(apiUrl);
  const data = await res.json();
  const ul = document.getElementById("commentList");
  ul.innerHTML = "";
  data.forEach(c => {
    const li = document.createElement("li");
    li.textContent = `${c.author} èªªï¼š${c.content}ï¼ˆ${new Date(c.createdAt).toLocaleString()}ï¼‰`;
    ul.appendChild(li);
  });
}

document.getElementById("commentForm").addEventListener("submit", async e => {
  e.preventDefault();
  const comment = {
    author: document.getElementById("author").value,
    content: document.getElementById("content").value
  };
  try {
    const res = await fetch(apiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(comment)
    });

    if (!res.ok) {
      const err = await res.text();
      alert("éŒ¯èª¤ï¼š" + err);
      return;
    }

    document.getElementById("commentForm").reset();
    loadComments();
  } catch (err) {
    alert("é€£ç·šå¤±æ•—ï¼š" + err.message);
  }
});

loadComments(); // åˆå§‹åŒ–è¼‰å…¥
```

---
## ğŸ” 3. è§€å¯Ÿèˆ‡é™¤éŒ¯

|ç¾è±¡|åŸå› æˆ–è™•ç†æ–¹å¼|
|---|---|
|è¡¨å–®é€å‡ºç„¡æ•ˆ|æª¢æŸ¥ `e.preventDefault()` æ˜¯å¦å¯«éŒ¯|
|å›å‚³ 400 éŒ¯èª¤|å¯èƒ½æ˜¯æœªå¡«å¯«å¿…è¦æ¬„ä½|
|Fetch å ±éŒ¯|æª¢æŸ¥ CORS æ˜¯å¦å•Ÿç”¨ã€ç¶²å€æ˜¯å¦æ­£ç¢º|
|è³‡æ–™æœªæ›´æ–°|æª¢æŸ¥æ˜¯å¦æœ‰é‡æ–°å‘¼å« `loadComments()`|

---
## ğŸ”— 4. å»¶ä¼¸åŠŸèƒ½èˆ‡ç·´ç¿’å»ºè­°

- åŠ ä¸Šç•™è¨€åˆªé™¤åŠŸèƒ½ï¼ˆåŠ ä¸Š DELETE APIï¼‰

- å‰ç«¯åŠ å…¥ loading å‹•ç•«èˆ‡è¡¨å–®é©—è­‰

- æ”¯æ´å¤šä¾†æºå‰ç«¯ï¼ˆå¦‚ React/Vue å°ˆæ¡ˆï¼‰

- ä½¿ç”¨ jQuery AJAX æ”¹å¯«ç·´ç¿’

- å°‡ç•™è¨€å­˜å…¥è³‡æ–™åº«ï¼ˆçµåˆ ADO.NET æˆ– EF Coreï¼‰

---

## ğŸ“¦ å°çµ

é€™å€‹ç•™è¨€ç³»çµ±æ¡ˆä¾‹æ¶µè“‹ AJAX ä¸»è¦æ‡‰ç”¨å ´æ™¯ï¼ŒåŒ…æ‹¬è³‡æ–™å‚³è¼¸ã€è¡¨å–®è™•ç†ã€éåŒæ­¥éŒ¯èª¤è™•ç†èˆ‡ API æ•´åˆï¼Œé©åˆç”¨ä¾†ç†Ÿæ‚‰å®Œæ•´çš„å‰å¾Œç«¯äº’å‹•æµç¨‹ã€‚

---

## ğŸ“š ç›¸é—œå¡ç‰‡

- [[013.1-Ajax-ä»€éº¼æ˜¯ AJAXï¼Ÿ]]
- [[013.3-Ajax-Fetch API ç¾ä»£å¯«æ³•]]
- [[013.5-Ajax-è™•ç† JSON èˆ‡å›å‚³è³‡æ–™]]
- [[013.6-Ajax-è¡¨å–®é€å‡ºèˆ‡éåŒæ­¥é©—è­‰]]
- [[013.8-Ajax-èˆ‡ ASP.NET Core Web API æ•´åˆ]]
- [[004-ADO.NETç¸½è¦½]]