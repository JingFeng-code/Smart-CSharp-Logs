---
title: ğŸ›ï¸ 011.8-CoreMVC-åˆ†å±¤æ¶æ§‹èˆ‡å°ˆæ¡ˆå¯¦å‹™è¨­è¨ˆ
tags:
  - ASP-NET
  - Core
  - MVC
  - åˆ†å±¤æ¶æ§‹
  - å°ˆæ¡ˆè¨­è¨ˆ
  - å¯¦å‹™ç¶“é©—
aliases:
  - CoreMVC åˆ†å±¤è¨­è¨ˆ
  - ASP.NET Core å°ˆæ¡ˆæ¶æ§‹
created: 2025-07-02
updated: 2025-07-02
status: å®Œæˆ
summary: ä»‹ç´¹ ASP.NET Core MVC åˆ†å±¤æ¶æ§‹ï¼ˆå¦‚ Controllerã€Serviceã€Repositoryï¼‰ã€æ¨¡çµ„åŒ–å°ˆæ¡ˆè¨­è¨ˆåŸå‰‡èˆ‡å¸¸è¦‹å¯¦å‹™ç¶“é©—ï¼Œå”åŠ©é–‹ç™¼é«˜å¯ç¶­è­·æ€§èˆ‡å¯æ“´å……çš„æ‡‰ç”¨ã€‚
---

åœ¨é–‹ç™¼ä»»ä½•è¦æ¨¡çš„æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œä¸€å€‹æ¸…æ™°ã€åˆç†çš„**æ¶æ§‹è¨­è¨ˆ**æ˜¯æˆåŠŸçš„é—œéµã€‚**åˆ†å±¤æ¶æ§‹ (Layered Architecture)** æ˜¯ä¸€ç¨®å»£æ³›æ‡‰ç”¨ä¸”è¡Œä¹‹æœ‰æ•ˆçš„æ–¹å¼ï¼Œå®ƒå°‡è¤‡é›œçš„æ‡‰ç”¨ç¨‹å¼æ‹†åˆ†ç‚ºå¤šå€‹è·è²¬æ˜ç¢ºã€ç›¸äº’å”ä½œçš„å±¤ç´šã€‚é€™ç¨®è¨­è¨ˆæ¨¡å¼æ¥µå¤§åœ°æå‡äº†è»Ÿé«”çš„**å¯ç¶­è­·æ€§ã€å¯æ¸¬è©¦æ€§ã€å¯æ“´å±•æ€§**ï¼Œä¸¦ä¿ƒé€²äº†åœ˜éšŠæˆå“¡ä¹‹é–“çš„**å”ä½œæ•ˆç‡**ã€‚

ASP.NET Core MVC ä½œç‚ºä¸€å€‹ç¾ä»£åŒ–çš„ Web æ¡†æ¶ï¼Œå…¶è¨­è¨ˆæœ¬èº«å°±é¼“å‹µåˆ†å±¤ã€‚ç†è§£ä¸¦å¯¦è¸è‰¯å¥½çš„åˆ†å±¤æ¶æ§‹ï¼Œæ˜¯å¾å…¥é–€åˆ°ç²¾é€š ASP.NET Core é–‹ç™¼çš„é‡è¦ä¸€æ­¥ã€‚

---

## ğŸ›ï¸ åˆ†å±¤æ¶æ§‹è¨­è¨ˆçš„æ ¸å¿ƒæ¦‚å¿µ

åˆ†å±¤æ¶æ§‹çš„ç›®æ¨™æ˜¯å¯¦ç¾**é—œæ³¨é»åˆ†é›¢ (Separation of Concerns)**ï¼Œå³æ¯å€‹å±¤ç´šåªè² è²¬æ‡‰ç”¨ç¨‹å¼ç‰¹å®šçš„ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚é€™ä½¿å¾—å–®ä¸€è·è²¬åŸå‰‡ (Single Responsibility Principle) å¾—ä»¥å¯¦è¸ï¼Œç•¶ç³»çµ±æŸéƒ¨åˆ†éœ€è¦è®Šæ›´æ™‚ï¼Œå½±éŸ¿ç¯„åœèƒ½å¤ è¢«æ§åˆ¶åœ¨æœ€å°ã€‚

åœ¨ ASP.NET Core MVC æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œå¸¸è¦‹çš„åˆ†å±¤çµæ§‹åŠå…¶è·è²¬å¦‚ä¸‹ï¼š

1. **è¡¨ç¤ºå±¤ (Presentation Layer)**ï¼š
    
    - **è·è²¬**ï¼šè™•ç†ä½¿ç”¨è€…ä»‹é¢èˆ‡ä½¿ç”¨è€…äº’å‹•ã€‚æ¥æ”¶ HTTP è«‹æ±‚ï¼Œå”èª¿æ¥­å‹™æµç¨‹ï¼Œä¸¦å°‡è™•ç†çµæœå‘ˆç¾çµ¦ä½¿ç”¨è€…ï¼ˆä¾‹å¦‚æ¸²æŸ“ View æˆ–è¿”å› API è³‡æ–™ï¼‰ã€‚
    
    - **çµ„ä»¶**ï¼šä¸»è¦æ˜¯ **Controllers** å’Œ **Views** (Razor Pages)ã€‚Controller æ¥æ”¶è«‹æ±‚ï¼Œèª¿ç”¨ Service å±¤è™•ç†æ¥­å‹™ï¼Œç„¶å¾Œæ±ºå®šå¦‚ä½•å›æ‡‰ï¼›View å‰‡è² è²¬æ¸²æŸ“ HTMLã€‚

2. **æ‡‰ç”¨ç¨‹å¼/æ¥­å‹™é‚è¼¯å±¤ (Application/Business Logic Layer - BLL / Service Layer)**ï¼š
    
    - **è·è²¬**ï¼šå°è£æ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒæ¥­å‹™è¦å‰‡å’Œæµç¨‹ã€‚å®ƒå”èª¿å¤šå€‹é ˜åŸŸæ¨¡å‹ (Domain Models) å’Œè³‡æ–™å­˜å–æ“ä½œï¼Œä»¥å®Œæˆç‰¹å®šçš„æ¥­å‹™ç”¨ä¾‹ã€‚
    
    - **çµ„ä»¶**ï¼š**Services** é¡åˆ¥ï¼ˆä¾‹å¦‚ `ProductService`ã€`OrderService`ï¼‰ã€‚Controller æ‡‰ç›¡é‡è¼•é‡ï¼Œåªè² è²¬èª¿ç”¨ Service å±¤çš„æ–¹æ³•ä¾†åŸ·è¡Œæ¥­å‹™é‚è¼¯ï¼Œè€Œä¸æ˜¯ç›´æ¥åŸ·è¡Œè¤‡é›œçš„æ¥­å‹™åˆ¤æ–·ã€‚

3. **é ˜åŸŸå±¤ (Domain Layer)**ï¼š
    
    - **è·è²¬**ï¼šåŒ…å«æ‡‰ç”¨ç¨‹å¼çš„**æ ¸å¿ƒè³‡æ–™çµæ§‹**ï¼ˆå³**é ˜åŸŸæ¨¡å‹**ï¼ŒDomain Modelsï¼‰ä»¥åŠèˆ‡é€™äº›è³‡æ–™ç·Šå¯†ç›¸é—œçš„**æ¥­å‹™è¦å‰‡å’Œè¡Œç‚º**ã€‚é€™æ˜¯æ‡‰ç”¨ç¨‹å¼çš„éˆé­‚ã€‚
    
    - **çµ„ä»¶**ï¼š**Models** é¡åˆ¥ï¼ˆä¾‹å¦‚ `Product`ã€`Order`ã€`User` ç­‰ï¼‰ã€‚é€™äº›ä¸åƒ…åƒ…æ˜¯è³‡æ–™å®¹å™¨ï¼Œé‚„å¯ä»¥åŒ…å«é©—è­‰é‚è¼¯ã€è¨ˆç®—å±¬æ€§ç­‰ã€‚**ViewModel** (æˆ– DTOs) é€šå¸¸ä¹Ÿæ”¾åœ¨é€™å€‹å±¤æˆ–èˆ‡ä¹‹ç›¸é—œçš„ç¨ç«‹è³‡æ–™å¤¾ï¼Œç”¨æ–¼ View å’Œ Service ä¹‹é–“çš„æ•¸æ“šå‚³è¼¸ã€‚

4. **è³‡æ–™å­˜å–å±¤ (Data Access Layer - DAL)**ï¼š
    
    - **è·è²¬**ï¼šè² è²¬èˆ‡è³‡æ–™åº«æˆ–å…¶ä»–å¤–éƒ¨æŒä¹…åŒ–å„²å­˜é€²è¡Œäº’å‹•ã€‚å®ƒå°‡é ˜åŸŸç‰©ä»¶æ˜ å°„åˆ°è³‡æ–™åº«çµæ§‹ï¼Œä¸¦åŸ·è¡Œ CRUD (Create, Read, Update, Delete) æ“ä½œã€‚
    
    - **çµ„ä»¶**ï¼š**DbContext** (Entity Framework Core)ã€**Repositories** (å€‰å„²æ¨¡å¼) å¯¦ä½œã€‚Repository æ¨¡å¼å¯ä»¥é€²ä¸€æ­¥éš”é›¢ ORMï¼ˆå¦‚ EF Coreï¼‰çš„å¯¦ä½œç´°ç¯€ï¼Œä½¿å¾—ä¸Šå±¤æ‡‰ç”¨ä¸ç›´æ¥ä¾è³´æ–¼ç‰¹å®šçš„è³‡æ–™å­˜å–æŠ€è¡“ã€‚


---

## ğŸ—‚ï¸ å°ˆæ¡ˆç›®éŒ„çµæ§‹å»ºè­°

åœ¨ Visual Studio ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨å–®ä¸€å°ˆæ¡ˆä¾†çµ„ç¹”é€™äº›å±¤ï¼Œæˆ–è€…å°æ–¼å¤§å‹å°ˆæ¡ˆï¼Œå°‡æ¯å€‹å±¤æ‹†åˆ†ç‚ºç¨ç«‹çš„é¡åˆ¥åº«å°ˆæ¡ˆï¼Œä»¥å¯¦ç¾æ›´åš´æ ¼çš„æ¨¡çµ„åŒ–å’Œä¾è³´ç®¡ç†ã€‚

### å–®ä¸€å°ˆæ¡ˆçµæ§‹ (é©ç”¨æ–¼ä¸­å°å‹å°ˆæ¡ˆ)
```text
MyWebApp/
â”œâ”€â”€ Controllers/         # è¡¨ç¤ºå±¤ï¼šè™•ç† HTTP è«‹æ±‚ï¼Œèª¿ç”¨ Service
â”œâ”€â”€ Services/            # æ‡‰ç”¨ç¨‹å¼/æ¥­å‹™é‚è¼¯å±¤ï¼šå°è£æ¥­å‹™é‚è¼¯ï¼Œèª¿ç”¨ Repository
â”‚   â”œâ”€â”€ Interfaces/      # å­˜æ”¾ Service çš„ä»‹é¢
â”‚   â””â”€â”€ Implementations/ # å­˜æ”¾ Service çš„å¯¦ä½œ
â”œâ”€â”€ Repositories/        # è³‡æ–™å­˜å–å±¤ï¼šå°è£è³‡æ–™åº«æ“ä½œ
â”‚   â”œâ”€â”€ Interfaces/      # å­˜æ”¾ Repository çš„ä»‹é¢
â”‚   â””â”€â”€ Implementations/ # å­˜æ”¾ Repository çš„å¯¦ä½œ
â”œâ”€â”€ Models/              # é ˜åŸŸå±¤ï¼šå­˜æ”¾ Domain Models (å¦‚ Product, Order)
â”‚   â”œâ”€â”€ ViewModels/      # å­˜æ”¾ ViewModels (ç‚º View é‡èº«å®šåˆ¶çš„æ•¸æ“šçµæ§‹)
â”‚   â””â”€â”€ DTOs/            # å­˜æ”¾ Data Transfer Objects (ç”¨æ–¼å±¤ä¹‹é–“å‚³è¼¸æ•¸æ“šï¼Œæˆ–ä½œç‚º API è«‹æ±‚/å›æ‡‰æ¨¡å‹)
â”œâ”€â”€ Data/                # è³‡æ–™å­˜å–å±¤ï¼šå­˜æ”¾ DbContext, Migrations, è³‡æ–™åº«åˆå§‹åŒ–ç¨®å­æ•¸æ“š
â”œâ”€â”€ Views/               # è¡¨ç¤ºå±¤ï¼šå­˜æ”¾ Razor è¦–åœ–æª”æ¡ˆ
â”œâ”€â”€ wwwroot/             # éœæ…‹è³‡æºï¼šCSS, JS, åœ–ç‰‡ç­‰
â”œâ”€â”€ appsettings.json     # æ‡‰ç”¨ç¨‹å¼çµ„æ…‹æª”
â”œâ”€â”€ Program.cs           # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»èˆ‡æœå‹™è¨»å†Š
â””â”€â”€ Startup.cs           # (èˆŠç‰ˆ .NET Core å°ˆæ¡ˆ) æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•èˆ‡é…ç½®
```

### å¤šå°ˆæ¡ˆçµæ§‹ (é©ç”¨æ–¼å¤§å‹å°ˆæ¡ˆæˆ–éœ€è¦æ›´åš´æ ¼åˆ†é›¢çš„å ´æ™¯)

å°æ–¼å¤§å‹å°ˆæ¡ˆï¼Œå°‡æ¯å€‹å±¤æ‹†åˆ†ç‚ºç¨ç«‹çš„é¡åˆ¥åº«å°ˆæ¡ˆæ˜¯æ›´å¸¸è¦‹çš„åšæ³•ã€‚é€™æä¾›äº†æ›´æ˜ç¢ºçš„ä¾è³´é—œä¿‚ï¼Œä¸¦æœ‰åŠ©æ–¼ç®¡ç†å¤§å‹ç¨‹å¼ç¢¼åº«ã€‚

```text
MySolution/
â”œâ”€â”€ MyWebApp.Api (æˆ– MyWebApp.Web)          # ä¸»å°ˆæ¡ˆï¼šMVC Controllers, Views, Program.cs, Startup.cs
â”‚   â””â”€â”€ References: MyWebApp.Application, MyWebApp.Domain, MyWebApp.Infrastructure.Data
â”œâ”€â”€ MyWebApp.Application                    # æ‡‰ç”¨ç¨‹å¼/æ¥­å‹™é‚è¼¯å±¤ï¼šService ä»‹é¢èˆ‡å¯¦ä½œ
â”‚   â””â”€â”€ References: MyWebApp.Domain, MyWebApp.Application.Interfaces (å¦‚æœä»‹é¢ç¨ç«‹)
â”œâ”€â”€ MyWebApp.Domain                         # é ˜åŸŸå±¤ï¼šDomain Models, Domain Events (é€šå¸¸ä¸ä¾è³´å…¶ä»–å°ˆæ¡ˆ)
â”œâ”€â”€ MyWebApp.Infrastructure.Data            # è³‡æ–™å­˜å–å±¤ï¼šDbContext, Repository å¯¦ä½œ, Migrations
â”‚   â””â”€â”€ References: MyWebApp.Domain
â”œâ”€â”€ MyWebApp.Infrastructure.CrossCutting    # è·¨é ˜åŸŸæœå‹™ï¼šä¾‹å¦‚æ—¥èªŒã€å¿«å–ã€Email ç™¼é€ (å¯é¸)
â”‚   â””â”€â”€ References: MyWebApp.Domain (å¦‚æœéœ€è¦)
â””â”€â”€ MyWebApp.Tests                          # æ¸¬è©¦å°ˆæ¡ˆï¼šå–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦
```

---
## ğŸ› ï¸ åˆ†å±¤å¯¦ä½œç¯„ä¾‹

ä»¥ä¸‹æ˜¯å„å±¤å¦‚ä½•å”åŒå·¥ä½œçš„ç°¡åŒ–ç¯„ä¾‹ï¼š

### 1. é ˜åŸŸå±¤ï¼šDomain Model
```csharp
// Models/Product.cs
using System.ComponentModel.DataAnnotations;

public class Product
{
    public int Id { get; set; }

    [Required]
    [StringLength(100)]
    public string Name { get; set; }

    [Range(0.01, 9999.99)]
    public decimal Price { get; set; }

    public DateTime CreatedAt { get; set; } = DateTime.Now;

    // å¯ä»¥åœ¨ Domain Model ä¸­åŒ…å«èˆ‡å…¶ç›¸é—œçš„æ¥­å‹™è¡Œç‚º
    // public void ApplyDiscount(decimal percentage) { ... }
}
```

### 2. è³‡æ–™å­˜å–å±¤ï¼šRepository ä»‹é¢èˆ‡å¯¦ä½œ

æˆ‘å€‘é€é**ä»‹é¢ (Interface)** ä¾†å®šç¾© Repository çš„å¥‘ç´„ï¼Œç„¶å¾Œæä¾›å…·é«”çš„å¯¦ä½œã€‚

```csharp
// Repositories/Interfaces/IProductRepository.cs
public interface IProductRepository
{
    Task<IEnumerable<Product>> GetAllAsync();
    Task<Product> GetByIdAsync(int id);
    Task AddAsync(Product entity);
    Task UpdateAsync(Product entity);
    Task DeleteAsync(int id);
    Task<bool> ExistsAsync(int id);
    Task SaveChangesAsync(); // é€šå¸¸æœƒåŒ…å«ä¸€å€‹ SaveChanges æˆ– Unit of Work æ–¹æ³•
}

// Repositories/Implementations/ProductRepository.cs
using Microsoft.EntityFrameworkCore;
// using MyWebApp.Data; // å‡è¨­ ApplicationDbContext çš„å‘½åç©ºé–“

public class ProductRepository : IProductRepository
{
    private readonly ApplicationDbContext _context;

    public ProductRepository(ApplicationDbContext context)
    {
        _context = context;
    }

    public async Task<IEnumerable<Product>> GetAllAsync()
    {
        return await _context.Products.ToListAsync();
    }

    public async Task<Product> GetByIdAsync(int id)
    {
        return await _context.Products.FindAsync(id);
    }

    public async Task AddAsync(Product entity)
    {
        await _context.Products.AddAsync(entity);
    }

    public async Task UpdateAsync(Product entity)
    {
        _context.Products.Update(entity);
    }

    public async Task DeleteAsync(int id)
    {
        var product = await _context.Products.FindAsync(id);
        if (product != null)
        {
            _context.Products.Remove(product);
        }
    }

    public async Task<bool> ExistsAsync(int id)
    {
        return await _context.Products.AnyAsync(e => e.Id == id);
    }

    public async Task SaveChangesAsync()
    {
        await _context.SaveChangesAsync();
    }
}
```

### 3. æ‡‰ç”¨ç¨‹å¼/æ¥­å‹™é‚è¼¯å±¤ï¼šService è¨­è¨ˆ

Service å±¤å°è£äº†æ‡‰ç”¨ç¨‹å¼çš„**æ¥­å‹™é‚è¼¯**ã€‚å®ƒæ¥æ”¶ä¾†è‡ª Controller çš„è«‹æ±‚ï¼Œä½¿ç”¨ä¸€å€‹æˆ–å¤šå€‹ Repository åŸ·è¡Œè³‡æ–™æ“ä½œï¼Œä¸¦æ‡‰ç”¨æ¥­å‹™è¦å‰‡ã€‚

```csharp
// Services/Interfaces/IProductService.cs
// é€šå¸¸æœƒå®šç¾©é‡å°æ¥­å‹™ç”¨ä¾‹çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ç›´æ¥æš´éœ² Repository çš„æ‰€æœ‰ CRUD
public interface IProductService
{
    Task<IEnumerable<ProductViewModel>> GetCatalogAsync(); // å¯èƒ½è¿”å› ViewModel
    Task<ProductViewModel> GetProductDetailsAsync(int id);
    Task<ProductViewModel> CreateProductAsync(ProductCreateDto createDto); // æ¥æ”¶ DTO
    Task UpdateProductAsync(int id, ProductUpdateDto updateDto);
    Task DeleteProductAsync(int id);
}

// Services/Implementations/ProductService.cs
// using MyWebApp.Repositories.Interfaces;
// using MyWebApp.Models;
// using MyWebApp.Models.ViewModels;
// using MyWebApp.Models.DTOs; // å‡è¨­æœ‰ DTOs

public class ProductService : IProductService
{
    private readonly IProductRepository _productRepo;
    // private readonly IMapper _mapper; // å¦‚æœä½¿ç”¨ AutoMapper

    public ProductService(IProductRepository productRepo /*, IMapper mapper */)
    {
        _productRepo = productRepo;
        // _mapper = mapper;
    }

    public async Task<IEnumerable<ProductViewModel>> GetCatalogAsync()
    {
        var products = await _productRepo.GetAllAsync();
        // return _mapper.Map<IEnumerable<ProductViewModel>>(products); // æ˜ å°„åˆ° ViewModel
        return products.Select(p => new ProductViewModel { Id = p.Id, Name = p.Name, Price = p.Price });
    }

    public async Task<ProductViewModel> GetProductDetailsAsync(int id)
    {
        var product = await _productRepo.GetByIdAsync(id);
        if (product == null) return null;
        // return _mapper.Map<ProductViewModel>(product);
        return new ProductViewModel { Id = product.Id, Name = product.Name, Price = product.Price };
    }

    public async Task<ProductViewModel> CreateProductAsync(ProductCreateDto createDto)
    {
        // æ¥­å‹™é‚è¼¯ï¼šä¾‹å¦‚æª¢æŸ¥åç¨±æ˜¯å¦é‡è¤‡ã€é€²è¡Œè¤‡é›œè¨ˆç®—ã€èª¿ç”¨å…¶ä»–æœå‹™
        // if (await _productRepo.ExistsAsync(p => p.Name == createDto.Name)) { throw new DuplicateNameException(); }

        // var product = _mapper.Map<Product>(createDto);
        var product = new Product { Name = createDto.Name, Price = createDto.Price };
        await _productRepo.AddAsync(product);
        await _productRepo.SaveChangesAsync(); // å„²å­˜è®Šæ›´
        // return _mapper.Map<ProductViewModel>(product);
        return new ProductViewModel { Id = product.Id, Name = product.Name, Price = product.Price };
    }

    public async Task UpdateProductAsync(int id, ProductUpdateDto updateDto)
    {
        var product = await _productRepo.GetByIdAsync(id);
        if (product == null) throw new KeyNotFoundException($"Product with ID {id} not found.");

        // æ¥­å‹™é‚è¼¯ï¼šä¾‹å¦‚åªå…è¨±æ›´æ–°éƒ¨åˆ†æ¬„ä½ï¼Œæˆ–è§¸ç™¼å…¶ä»–äº‹ä»¶
        // _mapper.Map(updateDto, product);
        product.Name = updateDto.Name;
        product.Price = updateDto.Price;

        await _productRepo.UpdateAsync(product);
        await _productRepo.SaveChangesAsync();
    }

    public async Task DeleteProductAsync(int id)
    {
        await _productRepo.DeleteAsync(id);
        await _productRepo.SaveChangesAsync();
    }
}
```

### 4. è¡¨ç¤ºå±¤ï¼šController æ³¨å…¥æœå‹™

Controller è² è²¬æ¥æ”¶ HTTP è«‹æ±‚ï¼Œèª¿ç”¨ Service å±¤çš„æ–¹æ³•ä¾†åŸ·è¡Œæ¥­å‹™æ“ä½œï¼Œä¸¦è¿”å›ç›¸æ‡‰çš„çµæœï¼ˆå¦‚ View æˆ– JSONï¼‰ã€‚

```csharp
// Controllers/ProductController.cs
using Microsoft.AspNetCore.Mvc;
// using MyWebApp.Services.Interfaces;
// using MyWebApp.Models.DTOs; // å‡è¨­æœ‰ DTOs
// using MyWebApp.Models.ViewModels; // å‡è¨­æœ‰ ViewModels

public class ProductController : Controller
{
    private readonly IProductService _productService; // æ³¨å…¥æ¥­å‹™é‚è¼¯æœå‹™

    public ProductController(IProductService productService)
    {
        _productService = productService;
    }

    // GET: /Product/Index
    public async Task<IActionResult> Index()
    {
        // Controller èª¿ç”¨ Serviceï¼Œç²å– ViewModelï¼Œç„¶å¾Œå‚³éçµ¦ View
        var products = await _productService.GetCatalogAsync();
        return View(products);
    }

    // GET: /Product/Details/{id}
    public async Task<IActionResult> Details(int id)
    {
        var product = await _productService.GetProductDetailsAsync(id);
        if (product == null)
        {
            return NotFound();
        }
        return View(product);
    }

    // GET: /Product/Create
    public IActionResult Create()
    {
        return View(); // è¿”å›ç©ºçš„ Create è¡¨å–®
    }

    // POST: /Product/Create
    [HttpPost]
    [ValidateAntiForgeryToken]
    public async Task<IActionResult> Create(ProductCreateDto createDto) // æ¥æ”¶ DTO
    {
        if (ModelState.IsValid)
        {
            try
            {
                var newProduct = await _productService.CreateProductAsync(createDto);
                TempData["SuccessMessage"] = $"ç”¢å“ '{newProduct.Name}' æ–°å¢æˆåŠŸï¼";
                return RedirectToAction(nameof(Index));
            }
            catch (Exception ex) // æ•ç² Service å±¤æ‹‹å‡ºçš„æ¥­å‹™ç•°å¸¸
            {
                ModelState.AddModelError("", $"æ–°å¢ç”¢å“å¤±æ•—: {ex.Message}");
            }
        }
        // å¦‚æœé©—è­‰å¤±æ•—æˆ– Service å±¤æ‹‹å‡ºç•°å¸¸ï¼Œè¿”å› View
        return View(createDto);
    }
}
```

### 5. æœå‹™è¨»å†Š (`Program.cs`)

ç‚ºäº†è®“ DI å®¹å™¨çŸ¥é“å¦‚ä½•æä¾›é€™äº›æœå‹™ï¼Œæˆ‘å€‘éœ€è¦åœ¨ `Program.cs` ä¸­è¨»å†Šå®ƒå€‘ã€‚

```csharp
// Program.cs
// ... (å…¶ä»– builder.Services é…ç½®) ...

// è¨»å†Šè³‡æ–™åº«ä¸Šä¸‹æ–‡ (é€šå¸¸æ˜¯ Scoped)
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

// è¨»å†Š Repository (é€šå¸¸æ˜¯ Scoped)
builder.Services.AddScoped<IProductRepository, ProductRepository>();

// è¨»å†Š Service (é€šå¸¸æ˜¯ Scoped)
builder.Services.AddScoped<IProductService, ProductService>();

// å¦‚æœä½¿ç”¨ AutoMapperï¼Œä¹Ÿéœ€è¦è¨»å†Š
// builder.Services.AddAutoMapper(typeof(Program)); // æƒææ‰€æœ‰è¨­å®šæª”

// ... (å…¶ä»– app.Use é…ç½®) ...
```

---
## ğŸ§© å°ˆæ¡ˆè¨­è¨ˆå¯¦å‹™å»ºè­°

- **ä»‹é¢å°å‘è¨­è¨ˆ (Interface-Driven Design)**ï¼š
    
    - æ‰€æœ‰å±¤ç´šä¹‹é–“çš„æ ¸å¿ƒäº¤äº’éƒ½æ‡‰é€é**ä»‹é¢**é€²è¡ŒæŠ½è±¡ï¼Œä¾‹å¦‚ `IProductService` è€Œé `ProductService`ã€‚é€™ä½¿å¾—å„å±¤ä¹‹é–“**è§£è€¦**ï¼Œä¾¿æ–¼å–®å…ƒæ¸¬è©¦å’Œæœªä¾†çš„å¯¦ä½œæ›¿æ›ã€‚

- **ä¾è³´æ³¨å…¥ (Dependency Injection - DI)**ï¼š
    
    - çµ±ä¸€ä½¿ç”¨ ASP.NET Core å…§å»ºçš„ DI å®¹å™¨ä¾†ç®¡ç†æœå‹™çš„ç”Ÿå‘½é€±æœŸå’Œä¾è³´é—œä¿‚ã€‚é¿å…ç›´æ¥åœ¨ç¨‹å¼ç¢¼ä¸­ `new` æœå‹™å¯¦ä¾‹ã€‚é€™ä½¿å¾—æ‡‰ç”¨ç¨‹å¼é«˜åº¦æ¨¡çµ„åŒ–ä¸”æ˜“æ–¼æ¸¬è©¦ã€‚

- **å–®ä¸€è·è²¬åŸå‰‡ (Single Responsibility Principle - SRP)**ï¼š
    
    - æ¯å€‹é¡åˆ¥æˆ–æ–¹æ³•éƒ½æ‡‰è©²åªæœ‰ä¸€å€‹è®ŠåŒ–çš„ç†ç”±ã€‚é€™ä½¿å¾—ç¨‹å¼ç¢¼æ›´æ˜“æ–¼ç†è§£ã€ç¶­è­·å’Œä¿®æ”¹ã€‚

- **DRY åŸå‰‡ (Don't Repeat Yourself)**ï¼š
    
    - é¿å…é‡è¤‡çš„ç¨‹å¼ç¢¼ã€‚ä¾‹å¦‚ï¼Œé€šç”¨çš„è³‡æ–™åº«æ“ä½œå¯ä»¥å°è£åœ¨é€šç”¨ Repository æˆ–æ“´å……æ–¹æ³•ä¸­ã€‚

- **é—œæ³¨é»åˆ†é›¢ (Separation of Concerns)**ï¼š
    
    - æ˜ç¢ºå„å±¤çš„è·è²¬ï¼Œä¾‹å¦‚ï¼šController ä¸è™•ç†æ¥­å‹™é‚è¼¯ï¼ŒService ä¸ç›´æ¥æ“ä½œè³‡æ–™åº«ï¼ˆé™¤éæ˜¯éå¸¸ç°¡å–®çš„æƒ…æ³æˆ–é€é Repository æ¨¡å¼ï¼‰ã€‚

- **æ¨¡çµ„åŒ–èˆ‡å¯æ“´å……æ€§**ï¼š
    
    - å°æ–¼å¤§å‹å°ˆæ¡ˆï¼Œè€ƒæ…®ä½¿ç”¨ **Area** (ASP.NET Core MVC å…§å»º) æˆ– **Feature Folder** çµæ§‹ï¼ŒæŒ‰åŠŸèƒ½æ¨¡çµ„çµ„ç¹”ç¨‹å¼ç¢¼ï¼Œè€Œä¸æ˜¯åƒ…æŒ‰å±¤ç´šçµ„ç¹”ã€‚
    
    - **CQRS (Command Query Responsibility Segregation)** æˆ– **DDD (Domain-Driven Design)** ç­‰é€²éšæ¶æ§‹æ¨¡å¼å¯ä»¥é€²ä¸€æ­¥æå‡å¯æ“´å±•æ€§å’Œè¤‡é›œé ˜åŸŸçš„è™•ç†èƒ½åŠ›ã€‚

- **æ¸¬è©¦å°å‘é–‹ç™¼ (Test-Driven Development - TDD)**ï¼š
    
    - è‰¯å¥½çš„åˆ†å±¤æ¶æ§‹å’Œä»‹é¢åŒ–è¨­è¨ˆæ˜¯é€²è¡Œå–®å…ƒæ¸¬è©¦çš„åŸºç¤ã€‚é€éç‚ºä»‹é¢å»ºç«‹æ¨¡æ“¬ (Mock) å¯¦ä½œï¼Œå¯ä»¥ç¨ç«‹æ¸¬è©¦æ¯å€‹å±¤æ¬¡çš„é‚è¼¯ã€‚
        
- **DTOs (Data Transfer Objects)** å’Œ **ViewModels**ï¼š
    
    - åœ¨å±¤èˆ‡å±¤ä¹‹é–“å‚³è¼¸è³‡æ–™æ™‚ï¼Œå°¤å…¶æ˜¯åœ¨ Service å±¤å’Œ Presentation å±¤ä¹‹é–“ï¼Œä½¿ç”¨ DTOs æˆ– ViewModels ä¾†é¿å…ç›´æ¥æš´éœ²é ˜åŸŸæ¨¡å‹ï¼Œä¿è­·æ•æ„Ÿæ•¸æ“šï¼Œä¸¦ç‚ºç‰¹å®šå ´æ™¯æä¾›ç²¾ç¢ºçš„æ•¸æ“šæ ¼å¼ã€‚**AutoMapper** ç­‰å·¥å…·å¯ä»¥å¤§å¤§ç°¡åŒ–é€™äº›ç‰©ä»¶ä¹‹é–“çš„æ˜ å°„ã€‚

---
## âš ï¸ å¸¸è¦‹å•é¡Œèˆ‡æ’æŸ¥

- **æ¥­å‹™é‚è¼¯éåº¦é›†ä¸­æ–¼ Controller (Fat Controller)**ï¼š
    
    - **å•é¡Œ**ï¼šå°è‡´ Controller è‡ƒè…«ã€é›£ä»¥æ¸¬è©¦å’Œç¶­è­·ã€‚
    
    - **è§£æ±º**ï¼šå°‡æ‰€æœ‰æ¥­å‹™æ±ºç­–ã€è¤‡é›œè¨ˆç®—ã€å¤šå€‹ Repository å”èª¿ç­‰é‚è¼¯ä¸‹æ”¾è‡³ Service å±¤ã€‚Controller æ‡‰ç›¡é‡ä¿æŒè¼•é‡ï¼Œåªè² è²¬è«‹æ±‚/éŸ¿æ‡‰çš„æµç¨‹æ§åˆ¶ã€‚

- **Repository èˆ‡ ORM è€¦åˆéæ·±**ï¼š
    
    - **å•é¡Œ**ï¼šå¦‚æœ Repository ç›´æ¥æš´éœ² EF Core çš„ `IQueryable` æˆ– `DbContext`ï¼Œæœƒå°è‡´å…¶ä½¿ç”¨è€…ç›´æ¥ä¾è³´æ–¼ EF Coreï¼Œå¤±å»è§£è€¦çš„å„ªå‹¢ã€‚
    
    - **è§£æ±º**ï¼šRepository ä»‹é¢æ‡‰åªæš´éœ²ç°¡å–®çš„ CRUD æ–¹æ³•ï¼Œè¿”å› POCO (Plain Old CLR Objects) é›†åˆï¼Œä¸æ´©æ¼ ORM çš„ç´°ç¯€ã€‚

- **è³‡æ–™é©—è­‰é‡è¤‡æˆ–åˆ†æ•£**ï¼š
    
    - **å•é¡Œ**ï¼šé©—è­‰é‚è¼¯å¯èƒ½åˆ†æ•£åœ¨ Model (è³‡æ–™è¨»è§£)ã€Controller (æ‰‹å‹• `ModelState.AddModelError`) å’Œ Service å±¤ã€‚
    
    - **è§£æ±º**ï¼šå„ªå…ˆä½¿ç”¨ **Model (è³‡æ–™è¨»è§£)** é€²è¡ŒåŸºæœ¬é©—è­‰ã€‚è¤‡é›œçš„**æ¥­å‹™é©—è­‰**ï¼ˆä¾‹å¦‚éœ€è¦æŸ¥è©¢è³‡æ–™åº«çš„é©—è­‰ï¼‰æ‡‰åœ¨ **Service å±¤**è™•ç†ï¼Œä¸¦å°‡éŒ¯èª¤è¨Šæ¯å›å ±çµ¦ Controller çš„ `ModelState`ã€‚

- **å‘½å/çµæ§‹æ··äº‚**ï¼š
    
    - **å•é¡Œ**ï¼šä¸ä¸€è‡´çš„å‘½åå’Œä¸æ¸…æ™°çš„ç›®éŒ„çµæ§‹æœƒé˜»ç¤™åœ˜éšŠå”ä½œå’Œæ–°æˆå“¡çš„å­¸ç¿’ã€‚
    
    - **è§£æ±º**ï¼šéµå¾ªæ¸…æ™°çš„å‘½åæ…£ä¾‹ï¼Œä¸¦å …æŒä¸€è‡´çš„åˆ†å±¤åŸå‰‡ã€‚ä½¿ç”¨æ–‡ä»¶æˆ– Wiki è¨˜éŒ„å°ˆæ¡ˆçš„æ¶æ§‹æŒ‡å—ã€‚

- **å¾ªç’°ä¾è³´ (Circular Dependencies)**ï¼š
    
    - **å•é¡Œ**ï¼šä¾‹å¦‚ Service A ä¾è³´ Service Bï¼Œè€Œ Service B åˆä¾è³´ Service Aï¼Œå°è‡´ DI å®¹å™¨ç„¡æ³•è§£æã€‚
    
    - **è§£æ±º**ï¼šé‡æ–°å¯©è¦–è¨­è¨ˆï¼Œæ‰¾å‡ºä¾è³´é—œä¿‚ä¸­çš„å¾ªç’°é»ï¼Œä¸¦é‡æ§‹ä»¥æ‰“ç ´å¾ªç’°ï¼Œé€šå¸¸æ˜¯å¼•å…¥æ–°çš„æŠ½è±¡æˆ–èª¿æ•´è·è²¬ã€‚

---
## ğŸ” å»¶ä¼¸å­¸ç¿’è³‡æº

- [**Microsoft Learnï¼šASP.NET Core æ‡‰ç”¨ç¨‹å¼æ¶æ§‹**]()ï¼šæä¾›å®˜æ–¹å°æ–¼ ASP.NET Core æ¶æ§‹è¨­è¨ˆçš„å»ºè­°å’Œæ¨¡å¼ã€‚
- [**Clean Architecture (ä¹¾æ·¨æ¶æ§‹)**](https://most.tw/posts/programminglanguage/dotnet8cleanarchitecture202405/)ï¼šç”± Robert C. Martin (Uncle Bob) æå‡ºçš„æ¶æ§‹åŸå‰‡ï¼Œæ—¨åœ¨å¯¦ç¾é«˜å…§èšã€ä½è€¦åˆã€å¯æ¸¬è©¦çš„ç³»çµ±ã€‚
- [**Domain-Driven Design (é ˜åŸŸé©…å‹•è¨­è¨ˆ - DDD)**](https://learn.microsoft.com/zh-tw/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/ddd-oriented-microservice)ï¼šä¸€ç¨®è»Ÿé«”é–‹ç™¼æ–¹æ³•ï¼Œå¼·èª¿å°‡é ˜åŸŸæ¨¡å‹ä½œç‚ºæ ¸å¿ƒï¼Œä»¥è§£æ±ºè¤‡é›œçš„æ¥­å‹™å•é¡Œã€‚
- [**CQRS (Command Query Responsibility Segregation)**](https://learn.microsoft.com/zh-tw/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/cqrs-microservice-reads)ï¼šä¸€ç¨®å°‡è®€å–å’Œå¯«å…¥æ“ä½œåˆ†é›¢çš„æ¶æ§‹æ¨¡å¼ï¼Œé©ç”¨æ–¼é«˜ä½µç™¼å’Œè¤‡é›œçš„ç³»çµ±ã€‚
- [**iT é‚¦å¹«å¿™ç³»åˆ—æ–‡ç« **](https://ithelp.ithome.com.tw/m/articles/10355422)ï¼šè¨±å¤šå°ç£é–‹ç™¼è€…åˆ†äº«çš„ .NET åˆ†å±¤å¯¦ä½œç¶“é©—ã€‚

---

## ğŸ”— ç›¸é—œå¡ç‰‡

- [[011.7-CoreMVC-èˆ‡è³‡æ–™åº«æ•´åˆ (EF Core)]]
- [[011.6-CoreMVC-ä¾è³´æ³¨å…¥èˆ‡æœå‹™è¨»å†Š]]
- [[011.11-CoreMVC-éŒ¯èª¤è™•ç†èˆ‡ä¸­ä»‹è»Ÿé«” (Middleware)]]
- [[011.17-CoreMVC-å‰ç«¯æ•´åˆèˆ‡è³‡æºç®¡ç†]]