---
title: 🏛️ 011.8-CoreMVC-分層架構與專案實務設計
tags:
  - ASP.NET Core
  - MVC
  - 分層架構
  - 專案設計
  - 實務經驗
aliases:
  - CoreMVC 分層設計
  - ASP.NET Core 專案架構
created: 2025-07-02
updated: 2025-07-02
status: 草稿
summary: 介紹 ASP.NET Core MVC 分層架構（如 Controller、Service、Repository）、模組化專案設計原則與常見實務經驗，協助開發高可維護性與可擴充的應用。
---

## 🏛️ 分層架構設計概念

- **分層架構（Layered Architecture）** 將應用程式拆分為多個職責明確的層級，提升可維護性、測試性與可擴充性。
- ASP.NET Core MVC 常見分層：
  - **Controller 層**：處理 HTTP 請求、協調流程、回應 View 或資料。
  - **Service 層**：封裝業務邏輯，減少 Controller 負擔。
  - **Repository 層**：資料存取，與資料庫互動，隔離 ORM 實作細節。
  - **Domain/Model 層**：資料結構、商業邏輯與驗證。

---

## 🗂️ 專案目錄結構建議

```text
MyProject/  
├── Controllers/ # 控制器  
├── Services/ # 業務邏輯服務  
├── Repositories/ # 資料存取  
├── Models/ # 資料模型、ViewModel  
├── Views/ # 視圖  
├── Data/ # DbContext、資料庫初始化  
├── Middleware/ # 中介軟體（可選）  
├── wwwroot/ # 靜態資源  
├── appsettings.json # 組態檔  
└── Program.cs # 應用程式進入點
```

- 依需求可擴充 **Helpers**、**DTOs**、**Mappers**、**Tests** 等目錄。

---
## 🛠️ 分層實作範例

### 1. Repository 介面與實作

```csharp
public interface IProductRepository  
{  
	IEnumerable<Product> GetAll();  
	Product GetById(int id);  
	void Add(Product entity);  
	void Update(Product entity);  
	void Delete(int id);  
}

public class ProductRepository : IProductRepository  
{  
	private readonly ApplicationDbContext _context;  
	public ProductRepository(ApplicationDbContext context)  
	{  
		_context = context;  
	}  
// 依介面實作資料存取邏輯  
}
```

### 2. Service 層設計

```csharp
public interface IProductService  
{  
	IEnumerable<Product> GetAllProducts();  
	Product GetProduct(int id);  
}

public class ProductService : IProductService  
{  
	private readonly IProductRepository _repo;  
	public ProductService(IProductRepository repo)  
	{  
		_repo = repo;  
	}  
// 封裝業務邏輯，調用 Repository  
}
```

### 3. Controller 注入服務

```csharp
public class ProductController : Controller  
{  
	private readonly IProductService _service;  
	public ProductController(IProductService service)  
	{  
		_service = service;  
	}
	public IActionResult Index()
	{
	    var products = _service.GetAllProducts();
	    return View(products);
	}
}
```


---

## 🧩 專案設計實務建議

- **介面導向設計**：Controller、Service、Repository 皆建議以介面抽象，方便單元測試與替換實作。
- **依賴注入**：所有服務、資料存取皆透過 DI 容器註冊與注入，避免直接 new 實例。
- **單一職責原則**：每層只負責單一職責，降低耦合度。
- **模組化與可擴充性**：大型專案可依功能模組拆分（如 Area、Feature Folder 結構）。
- **測試導向開發**：介面化設計有助於單元測試與 Mock。

---

## ⚠️ 常見問題與排查

- **業務邏輯過度集中於 Controller**：應下放至 Service 層。
- **Repository 與 ORM 耦合過深**：介面隔離，避免直接暴露 DbContext。
- **資料驗證重複**：統一於 Model 或 Service 層處理。
- **命名/結構混亂**：遵循命名慣例與分層原則，利於團隊協作。

---

## 🔍 延伸閱讀

- [Microsoft Learn：ASP.NET Core 分層架構設計]
- [iT 邦幫忙：.NET 分層實作經驗]
- [Clean Architecture、DDD、CQRS 等進階架構模式]

---

## 🔗 相關卡片

- [[011.7-CoreMVC-與資料庫整合 (EF Core)]]
- [[011.6-CoreMVC-依賴注入與服務註冊]]
- [[011.9-CoreMVC-錯誤處理與中介軟體 (Middleware)]]
