---
title: ğŸ§ª 011.12-CoreMVC-å–®å…ƒæ¸¬è©¦èˆ‡è‡ªå‹•åŒ–
tags:
  - ASP.NET Core
  - MVC
  - å–®å…ƒæ¸¬è©¦
  - è‡ªå‹•åŒ–æ¸¬è©¦
  - æ¸¬è©¦é©…å‹•é–‹ç™¼
aliases:
  - CoreMVC å–®å…ƒæ¸¬è©¦
  - ASP.NET Core æ¸¬è©¦è‡ªå‹•åŒ–
created: 2025-07-02
updated: 2025-07-02
status: è‰ç¨¿
summary: ä»‹ç´¹ ASP.NET Core MVC çš„å–®å…ƒæ¸¬è©¦èˆ‡è‡ªå‹•åŒ–åŸå‰‡ï¼Œæ¶µè“‹æ¸¬è©¦æ¶æ§‹ã€Mock æŠ€å·§ã€æ¸¬è©¦å¯¦ä½œç¯„ä¾‹ã€CI/CD æ•´åˆèˆ‡æœ€ä½³å¯¦å‹™ï¼Œå”åŠ©æå‡ç³»çµ±å“è³ªèˆ‡å¯ç¶­è­·æ€§ã€‚
---

## ğŸ§ª å–®å…ƒæ¸¬è©¦åŸºæœ¬æ¦‚å¿µ

- **å–®å…ƒæ¸¬è©¦ï¼ˆUnit Testï¼‰**ï¼šé‡å°ç¨‹å¼æœ€å°å¯æ¸¬å–®å…ƒï¼ˆå¦‚æ–¹æ³•ã€é¡åˆ¥ï¼‰é€²è¡Œé©—è­‰ï¼Œç¢ºä¿é‚è¼¯æ­£ç¢ºã€‚
- **è‡ªå‹•åŒ–æ¸¬è©¦**ï¼šåˆ©ç”¨å·¥å…·è‡ªå‹•åŸ·è¡Œæ¸¬è©¦ï¼Œæ¸›å°‘äººç‚ºç–æ¼ï¼Œæå‡é–‹ç™¼æ•ˆç‡èˆ‡ä¿¡å¿ƒã€‚
- **æ¸¬è©¦é‡‘å­—å¡”**ï¼šå–®å…ƒæ¸¬è©¦ > æ•´åˆæ¸¬è©¦ > UI/ç«¯å°ç«¯æ¸¬è©¦ï¼Œå–®å…ƒæ¸¬è©¦æ•¸é‡æ‡‰æœ€å¤šã€‚

---

## ğŸ› ï¸ ASP.NET Core MVC æ¸¬è©¦æ¶æ§‹

- å¸¸ç”¨æ¸¬è©¦æ¡†æ¶ï¼š**xUnit.net**ã€NUnitã€MSTest
- Mock å·¥å…·ï¼š**Moq**ã€NSubstitute
- å°ˆæ¡ˆå»ºè­°ï¼šä¸»ç¨‹å¼èˆ‡æ¸¬è©¦å°ˆæ¡ˆåˆ†é–‹ï¼Œæ¸¬è©¦å°ˆæ¡ˆç¨ç«‹å®‰è£æ¸¬è©¦èˆ‡ Mock å¥—ä»¶ã€‚

### æ¸¬è©¦å°ˆæ¡ˆå»ºç«‹èˆ‡å®‰è£

```text
dotnet new xunit -n MyApp.Tests  
dotnet add package Moq  
dotnet add package Microsoft.AspNetCore.Mvc.Testing
```

---
## ğŸ”„ ä¾è³´æ³¨å…¥èˆ‡ Mock æŠ€å·§

- **ä¾è³´æ³¨å…¥ï¼ˆDIï¼‰** è®“ Controller/Service å¯æ³¨å…¥ä»‹é¢ï¼Œå–®å…ƒæ¸¬è©¦æ™‚ä»¥ Mock å–ä»£å¯¦éš›æœå‹™ã€‚
- **Moq ç¯„ä¾‹**ï¼š
```csharp
var mockService = new Mock<IProductService>();  
mockService.Setup(s => s.GetAll()).Returns(new List<Product>Â { ... });

var controller = new ProductController(mockService.Object);
```

- æ¸¬è©¦æ™‚å¯æ¨¡æ“¬å›å‚³è³‡æ–™ã€ä¸Ÿå‡ºä¾‹å¤–ç­‰æƒ…å¢ƒã€‚

---
## ğŸ“ å–®å…ƒæ¸¬è©¦ç¯„ä¾‹ï¼ˆControllerï¼‰

```csharp
public class ProductControllerTests  
{  
	private readonly Mock<IProductService>Â _serviceMock;  
	private readonly ProductController _controller;
	public ProductControllerTests()
	{
	    _serviceMock = new Mock<IProductService>();
	    _controller = new ProductController(_serviceMock.Object);
	}

	[Fact]
	public void Index_ReturnsViewWithProducts()
	{
	    // Arrange
	    var products = new List<Product> { new Product { Id = 1, Name = "A" } };
	    _serviceMock.Setup(s => s.GetAll()).Returns(products);

	    // Act
	    var result = _controller.Index() as ViewResult;

	    // Assert
	    Assert.NotNull(result);
	    Assert.Equal(products, result.Model);
	}
}
```

---
## ğŸ§© é€²éšæ¸¬è©¦å·¥å…·èˆ‡æŠ€å·§

- **MyTested.AspNetCore.Mvc**ï¼šæä¾›æµæš¢èªæ³•ï¼Œæ”¯æ´ Controllerã€Routingã€é©—è­‰ã€æˆæ¬Šç­‰æ¸¬è©¦ã€‚
- **TestHost**ï¼šå¯æ¨¡æ“¬å®Œæ•´ HTTP è«‹æ±‚æµç¨‹ï¼Œé€²è¡Œæ•´åˆæ¸¬è©¦èˆ‡ API æ¸¬è©¦ã€‚
- **è‡ªå‹•åŒ– UI æ¸¬è©¦**ï¼šå¯ç”¨ Seleniumã€Playwrightã€Puppeteer ç­‰å·¥å…·æ¨¡æ“¬ç€è¦½å™¨æ“ä½œã€‚

---
## ğŸ† å–®å…ƒæ¸¬è©¦æœ€ä½³å¯¦å‹™

- **é¿å…åŸºç¤è¨­æ–½ä¾è³´**ï¼šå–®å…ƒæ¸¬è©¦ä¸æ‡‰ä¾è³´è³‡æ–™åº«ã€æª”æ¡ˆã€ç¶²è·¯ç­‰å¤–éƒ¨è³‡æºã€‚
- **æ˜ç¢ºå‘½å**ï¼šæ¸¬è©¦æ–¹æ³•å‘½åæ‡‰åŒ…å«ã€Œè¢«æ¸¬æ–¹æ³•_æƒ…å¢ƒ_é æœŸçµæœã€ï¼Œæå‡å¯è®€æ€§ã€‚
- **è¦†è“‹æ­£å‘èˆ‡è² å‘æ¡ˆä¾‹**ï¼šæ¸¬è©¦æ­£å¸¸æµç¨‹ã€ä¾‹å¤–èˆ‡é‚Šç•Œæƒ…å¢ƒã€‚
- **Mock å¤–éƒ¨ä¾è³´**ï¼šåˆ©ç”¨ Mock å·¥å…·æ¨¡æ“¬æœå‹™ã€APIã€è³‡æ–™å­˜å–ç­‰ã€‚
- **æŒçºŒé‡æ§‹èˆ‡è¦†è“‹ç‡æª¢æŸ¥**ï¼šå®šæœŸæª¢æŸ¥æ¸¬è©¦è¦†è“‹ç‡ï¼Œç¢ºä¿é—œéµé‚è¼¯çš†æœ‰æ¸¬è©¦ã€‚

---
## ğŸ”„ è‡ªå‹•åŒ–æ¸¬è©¦èˆ‡ CI/CD æ•´åˆ

- å°‡æ¸¬è©¦æ•´åˆè‡³ CI/CD æµç¨‹ï¼ˆå¦‚ GitHub Actionsã€Azure DevOpsã€GitLab CIï¼‰ï¼Œæ¯æ¬¡æäº¤è‡ªå‹•åŸ·è¡Œæ¸¬è©¦ã€‚
- æ¸¬è©¦å¤±æ•—æ™‚è‡ªå‹•é˜»æ“‹ä½ˆç½²ï¼Œç¢ºä¿å“è³ªã€‚

---
## âš ï¸ å¸¸è¦‹å•é¡Œèˆ‡å»ºè­°

- **æ¸¬è©¦éæ–¼ä¾è³´å¯¦ä½œç´°ç¯€**ï¼šæ‡‰èšç„¦æ–¼è¡Œç‚ºé©—è­‰ï¼Œé¿å…è„†å¼±æ¸¬è©¦ã€‚
- **æœª Mock ä¾è³´æœå‹™**ï¼šå°è‡´æ¸¬è©¦æ…¢ä¸”ä¸ç©©å®šï¼Œæ‡‰ Mock æ‰€æœ‰å¤–éƒ¨ä¾è³´ã€‚
- **æ¸¬è©¦å‘½åæ··äº‚**ï¼šé›£ä»¥ç¶­è­·èˆ‡ç†è§£ï¼Œå»ºè­°çµ±ä¸€å‘½åè¦å‰‡ã€‚
- **åªæ¸¬æ­£å‘æ¡ˆä¾‹**ï¼šéœ€è¦†è“‹ä¾‹å¤–ã€é‚Šç•Œèˆ‡å¤±æ•—æƒ…å¢ƒã€‚

---
## ğŸ” å»¶ä¼¸å­¸ç¿’è³‡æº

- [Microsoft Learnï¼š.NET å–®å…ƒæ¸¬è©¦æœ€ä½³å¯¦å‹™][1][6]
- [Pluralsightï¼šASP.NET Core MVC Testing Fundamentals][2]
- [C# Cornerï¼šUnit Test in ASP.NET Core Application][3]
- [MyTested.AspNetCore.Mvc å®˜æ–¹æ–‡ä»¶][4]
- [Testing of ASP.NET Core MVC apps using Microsoft Test Host][5]
- [Unit Testing ASP.NET MVC with Web API Best Practices][8]

---
## ğŸ”— ç›¸é—œå¡ç‰‡

- [[011.11-CoreMVC-æ•ˆèƒ½å„ªåŒ–èˆ‡å¿«å–]]
- [[011.13-CoreMVC-éƒ¨ç½²èˆ‡ç¶­é‹]]
- [[011.8-CoreMVC-åˆ†å±¤æ¶æ§‹èˆ‡å°ˆæ¡ˆå¯¦å‹™è¨­è¨ˆ]]





