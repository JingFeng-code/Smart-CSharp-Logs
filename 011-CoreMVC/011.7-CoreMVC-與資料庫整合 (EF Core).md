---
title: 🗄️ 011.7-CoreMVC-與資料庫整合 (EF Core)
tags:
  - ASP-NET
  - Core
  - MVC
  - EF
  - Core
  - 資料庫
  - ORM
aliases:
  - CoreMVC 資料庫
  - Entity Framework Core
created: 2025-07-02
updated: 2025-07-02
status: 草稿
summary: 介紹 ASP.NET Core MVC 與 Entity Framework Core (EF Core) 的整合流程，涵蓋安裝、設定、資料模型設計、DbContext、資料庫遷移與 CRUD 操作。
---

## 🗄️ EF Core 與 ASP.NET Core MVC 整合概述

- **Entity Framework Core (EF Core)** 是 .NET 的物件關聯對應（ORM）框架，支援 Code First、Database First 等開發模式。
- 可讓開發者以 C# 類別操作資料庫，簡化資料存取與維護流程。

---

## 🛠️ 整合步驟與基本流程

### 1. 安裝 EF Core 套件

- 於 NuGet 套件管理器或 CLI 安裝：
	`Install-Package Microsoft.EntityFrameworkCore.SqlServer`
	`Install-Package Microsoft.EntityFrameworkCore.Tools`

- 選擇對應的資料庫提供者（如 SQL Server、MySQL、PostgreSQL 等）[2][7]。

### 2. 設計資料模型（Model）

- 在 `Models/` 資料夾建立資料類別，對應資料表欄位。

```cshapr
public class Employee  
{  
	public int Id { get; set; }  
	public string Name { get; set; }  
	public string Designation { get; set; }  
}
```

- 可加上資料註解（Data Annotations）進行驗證。

### 3. 建立 DbContext

- DbContext 負責資料庫連線與資料集管理。

```csharp
public class ApplicationDbContext : DbContext  
{  
	public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
: base(options) { }

	public DbSet<Employee> Employees { get; set; }
}
```


### 4. 設定連線字串

- 在 `appsettings.json` 加入連線字串：

```csharp
"ConnectionStrings": {  
"DefaultConnection": "Server=localhost;Database=EmployeeDB;Trusted_Connection=True;"  
}
```


### 5. 註冊 DbContext 至 DI 容器

- 於 `Program.cs` 或 `Startup.cs` 的 `ConfigureServices` 註冊：

```csharp
builder.Services.AddDbContext<ApplicationDbContext>(options =>  
options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
```

- 這樣即可於 Controller 透過建構函式注入 DbContext。

### 6. 建立與更新資料庫（Migration）

- 使用 Migration 管理資料庫結構：

```text
Add-Migration InitialCreate  
Update-Database
```

- Migration 會根據 Model 產生/更新資料表。

### 7. CRUD 操作範例

- **新增資料**
```csharp
var employee = new Employee { Name = "John Doe", Designation = "Manager" };  
_context.Employees.Add(employee);  
_context.SaveChanges();
```

- **查詢資料**

```csharp
var employees = _context.Employees.ToList();
```

- **更新資料**

```csharp
var employee = _context.Employees.FirstOrDefault(e => e.Id == 1);  
if (employee != null)  
{  
	employee.Name = "Jane Doe";  
	_context.SaveChanges();  
}
```

- **刪除資料**

```csharp
var employee = _context.Employees.FirstOrDefault(e => e.Id == 1);  
if (employee != null)  
{  
	_context.Employees.Remove(employee);  
	_context.SaveChanges();  
}
```

---
## 🏗️ 專案結構與分層建議

- 建議將資料存取層（DbContext、Repository）與業務邏輯層分離，提升維護性與測試性。
- 可依實務需求擴充 Service Layer、Repository Pattern。

---
## ⚠️ 常見問題與排查

- **Migration 失敗**：確認連線字串正確、資料庫權限足夠。
- **DbContext 註冊遺漏**：未註冊將導致依賴注入錯誤。
- **資料模型變更未同步**：需重新執行 Migration 更新資料庫結構。
- **效能問題**：查詢時可善用 LINQ、分頁、Include 等技巧。

---

## 🔍 延伸學習資源

- [Microsoft Learn：ASP.NET Core MVC 與 EF Core 教學]
- [iT 邦幫忙：EF Core 實作教學][6]
- [GitHub 範例專案][5]

---

## 🔗 相關卡片

- [[011.6-CoreMVC-依賴注入與服務註冊]]
- [[011.8-CoreMVC-分層架構與專案實務設計]]
- [[007-LINQ-總覽]]
