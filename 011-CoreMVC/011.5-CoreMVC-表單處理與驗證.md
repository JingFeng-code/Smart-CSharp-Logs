---
title: 📝 011.5-CoreMVC-表單處理與驗證
tags:
  - ASP.NET Core
  - MVC
  - 表單
  - 資料驗證
  - Razor
aliases:
  - CoreMVC 表單處理
  - ASP.NET Core 資料驗證
created: 2025-07-02
updated: 2025-07-02
status: 草稿
summary: 介紹 ASP.NET Core MVC 的表單送出流程、伺服器端與用戶端驗證、ModelState 機制與常見表單設計技巧，協助建立安全且易用的資料輸入介面。
---

## 📝 表單處理流程概述

- ASP.NET Core MVC 支援強型別表單設計，結合 Razor 語法與 Model Binding，實現資料自動綁定與驗證。
- 一般表單送出流程：
  1. 使用者於 View 填寫表單並提交（POST）
  2. Controller 以 Action 方法接收 Model
  3. 檢查 ModelState 是否通過驗證
  4. 驗證成功則處理資料，否則回傳原頁面顯示錯誤

---

## 🛠️ 表單設計與 Razor 輔助方法

- 使用 `Html.BeginForm` 建立表單，`Html.TextBoxFor`、`Html.EditorFor`、`Html.ValidationMessageFor` 輔助欄位輸入與錯誤顯示。

```csharp
@model ProductViewModel

@using (Html.BeginForm("Create", "Product", FormMethod.Post))  
{  
	@Html.LabelFor(m => m.Name)  
	@Html.TextBoxFor(m => m.Name)  
	@Html.ValidationMessageFor(m => m.Name)
	@Html.LabelFor(m => m.Price)
	@Html.EditorFor(m => m.Price)
	@Html.ValidationMessageFor(m => m.Price)

	<button type="submit">送出</button>
}
```

- 支援下拉選單、核取方塊、隱藏欄位等多種表單元素。

---
## 🔄 Model Binding 與資料驗證

- Controller 以 Model 參數接收表單資料，ASP.NET Core 會自動綁定欄位。

```csharp
[HttpPost]  
public IActionResult Create(ProductViewModel model)  
{  
if (ModelState.IsValid)  
{  
// 資料驗證通過，執行新增邏輯  
return RedirectToAction("Index");  
}  
// 驗證失敗，回傳原頁面並顯示錯誤訊息  
return View(model);  
}
```

- ModelState 物件記錄驗證結果，可於 View 顯示錯誤訊息。

---
## ✅ 資料驗證機制

- 支援 **伺服器端驗證**（C# 資料註解）與 **用戶端驗證**（自動產生 JS 驗證）。
- 常用資料註解：
  - `[Required]` 必填
  - `[StringLength(100)]` 長度限制
  - `[Range(0, 99999)]` 數值範圍
  - `[EmailAddress]` Email 格式
  - `[Compare("Password")]` 兩欄位比對

```csharp
public class ProductViewModel  
{  
	[Required(ErrorMessage = "名稱必填")]  
	public string Name { get; set; }
	[Range(1, 99999, ErrorMessage = "價格需大於 0")]
	public decimal Price { get; set; }
}
```

---
## 🖥️ 用戶端驗證啟用

- 確認 View 已引用驗證腳本：

```csharp
@section Scripts {  
	@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}  
}
```


- 用戶端驗證可即時提示錯誤，提升使用體驗。

---
## 🛡️ 安全性與實務建議

- **防止 CSRF**：`Html.BeginForm` 會自動插入 AntiForgery Token，Controller 需加 `[ValidateAntiForgeryToken]`。
- **避免過度信任用戶端驗證**，伺服器端驗證必不可少。
- **錯誤訊息多語系支援**：可自訂資源檔案。
- **善用 ViewModel 隔離表單資料**，避免過度綁定（Overposting）。

---
## ⚠️ 常見問題與排查

- **ModelState 無效**：檢查資料註解、欄位名稱對應與表單元素 name 屬性。
- **用戶端驗證無效**：確認已正確引用驗證 JS 檔案。
- **過度綁定風險**：建議只綁定需要的欄位，避免資料外洩。

---
## 🔗 相關卡片

- [[011.3-CoreMVC-模型設計與資料綁定 (Model)]]
- [[011.4-CoreMVC-視圖與 Razor 語法 (View)]]
- [[011.6-CoreMVC-依賴注入與服務註冊]]



