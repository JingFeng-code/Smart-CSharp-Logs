---
title: âš¡ 011.14-CoreMVC-æ•ˆèƒ½å„ªåŒ–èˆ‡å¿«å– (Performance Optimization & Caching)
tags:
  - ASP-NET
  - Core
  - æ•ˆèƒ½å„ªåŒ–
  - å¿«å–
  - Caching
  - Response-Caching
  - Memory-Cache
  - Distributed-Cache
  - Gzip
  - Minification
  - Bundling
aliases:
  - CoreMVC æ•ˆèƒ½
  - ASP.NET Core å¿«å–
  - Web æ•ˆèƒ½
created: 2025-07-10
updated: 2025-07-10
status: å®Œæˆ
summary: æœ¬ç­†è¨˜æ·±å…¥æ¢è¨ ASP.NET Core MVC æ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½å„ªåŒ–ç­–ç•¥èˆ‡å¿«å–æ©Ÿåˆ¶ã€‚å…§å®¹æ¶µè“‹å‰ç«¯å„ªåŒ–ï¼ˆå£“ç¸®ã€æ‰“åŒ…ï¼‰ã€å¾Œç«¯å„ªåŒ–ï¼ˆéåŒæ­¥ã€æ•¸æ“šåº«å„ªåŒ–ã€å¿«å–æŠ€è¡“ï¼‰ã€ä»¥åŠå„ç¨®å¿«å–é¡å‹ï¼ˆè¨˜æ†¶é«”å¿«å–ã€åˆ†æ•£å¼å¿«å–ã€éŸ¿æ‡‰å¿«å–ï¼‰çš„å¯¦ä½œèˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œå”åŠ©é–‹ç™¼è€…å»ºæ§‹é«˜æ•ˆèƒ½ã€é«˜éŸ¿æ‡‰åº¦çš„ Web æ‡‰ç”¨ç¨‹å¼ã€‚
---

åœ¨ç¾ä»£ Web æ‡‰ç”¨ç¨‹å¼ä¸­ï¼Œ**æ•ˆèƒ½ (Performance)** æ˜¯æ±ºå®šä½¿ç”¨è€…é«”é©—å’Œç³»çµ±æ“´å±•èƒ½åŠ›çš„é—œéµå› ç´ ã€‚ä¸€å€‹éŸ¿æ‡‰è¿…é€Ÿçš„æ‡‰ç”¨ç¨‹å¼ä¸åƒ…èƒ½æå‡ç”¨æˆ¶æ»¿æ„åº¦ï¼Œä¹Ÿèƒ½ç¯€çœé‹ç‡Ÿæˆæœ¬ã€‚**å¿«å– (Caching)** æ˜¯ä¸€ç¨®æœ€æœ‰æ•ˆä¸”æœ€ç›´æ¥çš„æ•ˆèƒ½å„ªåŒ–æ‰‹æ®µï¼Œå®ƒé€šéæš«å­˜ç¶“å¸¸è¨ªå•çš„æ•¸æ“šæˆ–éŸ¿æ‡‰ï¼Œæ¸›å°‘é‡è¤‡è¨ˆç®—å’Œç¶²è·¯å¾€è¿”ï¼Œå¾è€Œé¡¯è‘—é™ä½å»¶é²ä¸¦æå‡ååé‡ã€‚

ASP.NET Core æä¾›äº†å¤šç¨®å·¥å…·å’ŒæŠ€è¡“ä¾†å¹«åŠ©æ‚¨å„ªåŒ–æ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½ï¼Œä¸¦å¯¦æ–½æœ‰æ•ˆçš„å¿«å–ç­–ç•¥ã€‚

---

## âš¡ æ•ˆèƒ½å„ªåŒ–ç­–ç•¥ç¸½è¦½

æ•ˆèƒ½å„ªåŒ–æ˜¯ä¸€å€‹å¤šå±¤æ¬¡çš„éç¨‹ï¼Œæ¶‰åŠå‰ç«¯ã€å¾Œç«¯ã€è³‡æ–™åº«å’ŒåŸºç¤è¨­æ–½ç­‰å¤šå€‹æ–¹é¢ã€‚

### 1. å‰ç«¯æ•ˆèƒ½å„ªåŒ–

ä¸»è¦ç›®æ¨™æ˜¯æ¸›å°‘ç€è¦½å™¨ä¸‹è¼‰å’Œæ¸²æŸ“é é¢çš„æ™‚é–“ã€‚

- **å£“ç¸® (Minification)**ï¼šç§»é™¤ JavaScriptã€CSS å’Œ HTML æ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¸å¿…è¦çš„å­—å…ƒï¼ˆå¦‚ç©ºæ ¼ã€æ›è¡Œç¬¦ã€è¨»é‡‹ï¼‰ï¼Œè€Œä¸æ”¹è®Šå…¶åŠŸèƒ½ã€‚é€™èƒ½é¡¯è‘—æ¸›å°æª”æ¡ˆå¤§å°ã€‚

- **æ‰“åŒ… (Bundling)**ï¼šå°‡å¤šå€‹ JavaScript æˆ– CSS æ–‡ä»¶åˆä½µæˆä¸€å€‹å–®ä¸€æ–‡ä»¶ã€‚é€™æ¸›å°‘äº†ç€è¦½å™¨ç™¼å‡ºçš„ HTTP è«‹æ±‚æ•¸é‡ï¼Œå¾è€ŒåŠ é€Ÿé é¢è¼‰å…¥ã€‚
    
    - ASP.NET Core é€šå¸¸ä½¿ç”¨ **Bundler & Minifier** æ“´å±•æˆ– Gulp/Webpack ç­‰å·¥å…·ä¾†å¯¦ç¾ã€‚

- **Gzip/Brotli å£“ç¸® (Compression)**ï¼šä¼ºæœå™¨ç«¯å°éŸ¿æ‡‰å…§å®¹é€²è¡Œå£“ç¸®ï¼ˆä¾‹å¦‚ HTML, CSS, JS, JSON ç­‰æ–‡æœ¬å…§å®¹ï¼‰ï¼Œç„¶å¾Œå‚³è¼¸çµ¦ç€è¦½å™¨ï¼Œç€è¦½å™¨è§£å£“å¾Œé¡¯ç¤ºã€‚é€™èƒ½å¤§å¹…æ¸›å°‘ç¶²è·¯å‚³è¼¸é‡ã€‚
    
    - ASP.NET Core é€é **Response Compression Middleware** å¯¦ç¾ã€‚

- **éœæ…‹æª”æ¡ˆå¿«å– (Static File Caching)**ï¼šè¨­ç½®éœæ…‹æª”æ¡ˆï¼ˆåœ–ç‰‡ã€CSSã€JSï¼‰çš„ç·©å­˜é ­ï¼Œè®“ç€è¦½å™¨åœ¨å¾ŒçºŒè¨ªå•æ™‚ç›´æ¥å¾æœ¬åœ°å¿«å–è¼‰å…¥ã€‚

### 2. å¾Œç«¯æ•ˆèƒ½å„ªåŒ–

ä¸»è¦ç›®æ¨™æ˜¯æ¸›å°‘ä¼ºæœå™¨è™•ç†è«‹æ±‚çš„æ™‚é–“å’Œè³‡æºæ¶ˆè€—ã€‚

- **éåŒæ­¥ç¨‹å¼è¨­è¨ˆ (Async/Await)**ï¼š
    
    - å¦‚ [[011.10-CoreMVC-éåŒæ­¥ç¨‹å¼è¨­è¨ˆ (Async Await)]] ä¸­æ‰€è¿°ï¼Œä½¿ç”¨ `async/await` å¯ä»¥é‡‹æ”¾åŸ·è¡Œç·’ï¼Œé˜²æ­¢ I/O å¯†é›†å‹æ“ä½œé˜»å¡è«‹æ±‚è™•ç†ã€‚é€™æ˜¯ ASP.NET Core æ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½å„ªåŒ–çš„åŸºçŸ³ã€‚

- **å¿«å– (Caching)**ï¼š
    
    - é€™æ˜¯æœ€é‡è¦çš„å¾Œç«¯å„ªåŒ–æ‰‹æ®µï¼Œè©³è¦‹å¾ŒçºŒç« ç¯€ã€‚

- **æ•¸æ“šåº«å„ªåŒ–**ï¼š
    
    - **é«˜æ•ˆæŸ¥è©¢**ï¼šä½¿ç”¨ `Select` æŠ•å½±ã€`Include` å»¶é²è¼‰å…¥ã€åˆ†é ã€é©ç•¶çš„ç´¢å¼•ã€é¿å… N+1 æŸ¥è©¢å•é¡Œã€‚
    
    - **æ‰¹æ¬¡æ“ä½œ**ï¼šå°æ–¼å¤§é‡æ•¸æ“šçš„å¢åˆªæ”¹ï¼Œä½¿ç”¨æ‰¹æ¬¡æ“ä½œè€Œéå–®æ¢é€å€‹åŸ·è¡Œã€‚
    
    - **é€£æ¥æ± **ï¼šç¢ºä¿è³‡æ–™åº«é€£æ¥è¢«æœ‰æ•ˆåœ°ç®¡ç†å’Œé‡ç”¨ã€‚

- **æ¸›å°‘ä¸å¿…è¦çš„è¨ˆç®—å’Œè³‡æºè¨ªå•**ï¼š
    
    - å¯©æŸ¥ä»£ç¢¼é‚è¼¯ï¼Œæ¶ˆé™¤å†—é¤˜è¨ˆç®—ã€‚
    
    - é¿å…åœ¨ç†±é»è·¯å¾‘ (Hot Path) ä¸ŠåŸ·è¡Œè€—æ™‚æ“ä½œã€‚

- **è² è¼‰å¹³è¡¡èˆ‡æ“´å±•æ€§**ï¼š
    
    - åœ¨å¤šå€‹ä¼ºæœå™¨ä¸Šéƒ¨ç½²æ‡‰ç”¨ç¨‹å¼ï¼Œä¸¦ä½¿ç”¨è² è¼‰å¹³è¡¡å™¨åˆ†ç™¼è«‹æ±‚ã€‚
    
    - è¨­è¨ˆæ‡‰ç”¨ç¨‹å¼ç‚ºç„¡ç‹€æ…‹ï¼Œä»¥ä¾¿æ°´å¹³æ“´å±•ã€‚

- **æ—¥èªŒå„ªåŒ–**ï¼š
    
    - æ§åˆ¶æ—¥èªŒç´šåˆ¥ï¼Œé¿å…åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­è¼¸å‡ºéæ–¼è©³ç´°çš„æ—¥èªŒï¼Œé€™æœƒç”¢ç”Ÿ I/O é–‹éŠ·ã€‚

---

## ğŸš€ ASP.NET Core ä¸­çš„å¿«å–æŠ€è¡“

ASP.NET Core æä¾›äº†å¤šç¨®å¿«å–æ©Ÿåˆ¶ï¼Œé©ç”¨æ–¼ä¸åŒçš„å ´æ™¯ï¼š

### 1. éŸ¿æ‡‰å¿«å– (Response Caching)

- **æ©Ÿåˆ¶**ï¼šå°‡æ•´å€‹ HTTP éŸ¿æ‡‰å„²å­˜åœ¨ä¼ºæœå™¨ç«¯ã€‚ç•¶ç›¸åŒè«‹æ±‚å†æ¬¡åˆ°é”æ™‚ï¼Œç›´æ¥å¾å¿«å–ä¸­è¿”å›éŸ¿æ‡‰ï¼Œè€Œç„¡éœ€åŸ·è¡Œ Controller Action æˆ–ç”Ÿæˆ Viewã€‚

- **é©ç”¨å ´æ™¯**ï¼šéœæ…‹æˆ–æ›´æ–°ä¸é »ç¹çš„é é¢å…§å®¹ã€API éŸ¿æ‡‰ã€‚

- **å¯¦ç¾**ï¼š
    
    - **å®‰è£ NuGet å¥—ä»¶**ï¼š`Microsoft.AspNetCore.OutputCaching` (ASP.NET Core 7.0+ æ¨è–¦ï¼Œå–ä»£ `Microsoft.AspNetCore.ResponseCaching`)
    
    - **åœ¨ `Program.cs` ä¸­è¨»å†Šæœå‹™å’Œä¸­ä»‹è»Ÿé«”**ï¼š

```csharp
// Program.cs
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllersWithViews();

// è¨»å†ŠéŸ¿æ‡‰å¿«å–æœå‹™
builder.Services.AddOutputCache(); // ASP.NET Core 7.0+ æ–°çš„è¼¸å‡ºå¿«å–

var app = builder.Build();

// åœ¨ UseRouting ä¹‹å¾Œï¼ŒMapControllers/MapRazorPages ä¹‹å‰ä½¿ç”¨éŸ¿æ‡‰å¿«å–ä¸­ä»‹è»Ÿé«”
app.UseOutputCache(); // ASP.NET Core 7.0+ æ–°çš„è¼¸å‡ºå¿«å–ä¸­ä»‹è»Ÿé«”

app.UseRouting();
app.UseAuthorization();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");

app.Run();
```

- **åœ¨ Controller Action ä¸Šä½¿ç”¨ `[OutputCache]` ç‰¹æ€§**ï¼š

```csharp
// Controllers/ProductController.cs
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.OutputCaching; // å¼•å…¥å‘½åç©ºé–“ (ASP.NET Core 7.0+)

public class ProductController : Controller
{
    [OutputCache(Duration = 60, VaryByQueryKeys = new[] { "page", "pageSize" })] // å¿«å– 60 ç§’ï¼Œä¸¦æ ¹æ“š page å’Œ pageSize æŸ¥è©¢å­—ä¸²åƒæ•¸è®ŠåŒ–
    // ä¹Ÿå¯ä»¥ä½¿ç”¨ PolicyName = "CachePolicyName" ä¾†å¼•ç”¨é å®šç¾©çš„å¿«å–ç­–ç•¥
    public IActionResult Index(int page = 1, int pageSize = 10)
    {
        // å¾è³‡æ–™åº«æˆ–å…¶ä»–æœå‹™ç²å–ç”¢å“åˆ—è¡¨
        var products = _productService.GetProducts(page, pageSize);
        ViewBag.Timestamp = DateTime.Now.ToString("HH:mm:ss"); // é¡¯ç¤ºæ™‚é–“æˆ³ä»¥è§€å¯Ÿå¿«å–æ•ˆæœ
        return View(products);
    }

    [OutputCache(NoStore = true, Duration = 0)] // ä¸å¿«å–ï¼Œç¸½æ˜¯å¾æºé ­ç²å–
    public IActionResult MyAccount()
    {
        return View();
    }
}
```

- **é å®šç¾©å¿«å–ç­–ç•¥ (ASP.NET Core 7.0+ Output Caching)**ï¼š

```csharp
// Program.cs
builder.Services.AddOutputCache(options =>
{
    options.AddPolicy("MyCachePolicy", policy =>
        policy.Expire(TimeSpan.FromSeconds(30))
              .Tag("products") // ç‚ºå¿«å–é …æ‰“æ¨™ç±¤ï¼Œæ–¹ä¾¿å¤±æ•ˆ
              .VaryByHeader("User-Agent") // æ ¹æ“š User-Agent é ­çš„ä¸åŒç”Ÿæˆä¸åŒçš„å¿«å–
              .SetIs  ("å…è¨±æ‰€æœ‰èº«ä»½é©—è­‰çš„ç”¨æˆ¶å…±äº«å¿«å–"));
    // ...æ›´å¤šç­–ç•¥...
});

// åœ¨ Controller ä¸­ä½¿ç”¨ [OutputCache(PolicyName = "MyCachePolicy")]
```

- **å¤±æ•ˆ (Invalidation)**ï¼šå¯ä»¥é€šé `IOutputCacheStore` æœå‹™ä¾†æ‰‹å‹•æ¸…é™¤å¿«å–é …ï¼ˆåŸºæ–¼ Tagï¼‰ï¼Œæˆ–é€šéè¨­ç½®è¼ƒçŸ­çš„ `Duration`ã€‚

### 2. è¨˜æ†¶é«”å¿«å– (In-Memory Caching)

- **æ©Ÿåˆ¶**ï¼šå°‡æ•¸æ“šå„²å­˜åœ¨æ‡‰ç”¨ç¨‹å¼é‹è¡Œæ‰€åœ¨çš„ä¼ºæœå™¨çš„è¨˜æ†¶é«”ä¸­ã€‚

- **é©ç”¨å ´æ™¯**ï¼šå°å‹ã€å–®ä¸€ä¼ºæœå™¨éƒ¨ç½²ï¼Œå¿«å–æ•¸æ“šé‡ä¸å¤§ï¼Œä¸éœ€è¦è·¨å¤šå€‹ä¼ºæœå™¨å…±äº«ã€‚

- **å¯¦ç¾**ï¼š
    
    - **å®‰è£ NuGet å¥—ä»¶**ï¼š`Microsoft.Extensions.Caching.Memory` (é€šå¸¸å·²åŒ…å«åœ¨ Web SDK ä¸­)
    
    - **åœ¨ `Program.cs` ä¸­è¨»å†Šæœå‹™**ï¼š
	```csharp
	builder.Services.AddMemoryCache(); // è¨»å†Šè¨˜æ†¶é«”å¿«å–æœå‹™
	```
	- **åœ¨éœ€è¦ä½¿ç”¨çš„é¡åˆ¥ä¸­æ³¨å…¥ `IMemoryCache`**ï¼š
	```csharp
// Services/ProductService.cs
using Microsoft.Extensions.Caching.Memory;
using System.Collections.Generic;
using System.Threading.Tasks;

public class ProductService
{
    private readonly IMemoryCache _cache;
    private readonly ApplicationDbContext _dbContext; // å‡è¨­æœ‰è³‡æ–™åº«ä¸Šä¸‹æ–‡

    public ProductService(IMemoryCache cache, ApplicationDbContext dbContext)
    {
        _cache = cache;
        _dbContext = dbContext;
    }

    public async Task<IEnumerable<Product>> GetProductsFromCacheOrDbAsync()
    {
        string cacheKey = "AllProducts";
        IEnumerable<Product> products;

        // å˜—è©¦å¾å¿«å–ä¸­ç²å–æ•¸æ“š
        if (!_cache.TryGetValue(cacheKey, out products))
        {
            // å¦‚æœå¿«å–ä¸­æ²’æœ‰ï¼Œå‰‡å¾è³‡æ–™åº«ç²å–
            products = await _dbContext.Products.ToListAsync();

            // è¨­ç½®å¿«å–é¸é …
            var cacheEntryOptions = new MemoryCacheEntryOptions()
                .SetSlidingExpiration(TimeSpan.FromMinutes(5)) // æ»‘å‹•éæœŸï¼š5åˆ†é˜æ²’æœ‰è¨ªå•å‰‡å¤±æ•ˆ
                .SetAbsoluteExpiration(TimeSpan.FromHours(1)) // çµ•å°éæœŸï¼š1å°æ™‚å¾Œç„¡è«–å¦‚ä½•éƒ½å¤±æ•ˆ
                .SetPriority(CacheItemPriority.Normal); // å¿«å–é …çš„å„ªå…ˆç´š

            // å°‡æ•¸æ“šæ·»åŠ åˆ°å¿«å–
            _cache.Set(cacheKey, products, cacheEntryOptions);
        }
        return products;
    }

    public void ClearProductCache()
    {
        _cache.Remove("AllProducts"); // æ‰‹å‹•æ¸…é™¤å¿«å–
    }
}
	```
- **å„ªé»**ï¼šç°¡å–®ã€é«˜æ•ˆã€ä½å»¶é²ã€‚

- **ç¼ºé»**ï¼š
    - æ•¸æ“šåªå­˜åœ¨æ–¼å–®ä¸€ä¼ºæœå™¨ï¼Œä¸é©ç”¨æ–¼å¤šä¼ºæœå™¨éƒ¨ç½²ã€‚
    - æ‡‰ç”¨ç¨‹å¼é‡å•Ÿæœƒæ¸…é™¤æ‰€æœ‰å¿«å–ã€‚
    - å¯èƒ½å°è‡´è¨˜æ†¶é«”å£“åŠ›ã€‚

### 3. åˆ†æ•£å¼å¿«å– (Distributed Caching)

- **æ©Ÿåˆ¶**ï¼šå°‡æ•¸æ“šå„²å­˜åœ¨ç¨ç«‹çš„å¤–éƒ¨å¿«å–æœå‹™ä¸­ï¼ˆå¦‚ Redis, SQL Serverï¼‰ï¼Œä¾›å¤šå€‹æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹å…±äº«ã€‚

- **é©ç”¨å ´æ™¯**ï¼šå¤šä¼ºæœå™¨éƒ¨ç½²ã€å¾®æœå‹™æ¶æ§‹ï¼Œéœ€è¦è·¨æ‡‰ç”¨ç¨‹å¼å¯¦ä¾‹å…±äº«å¿«å–æ•¸æ“šã€‚

- **å¸¸è¦‹å¯¦ç¾**ï¼š
    
    - **Redis Cache (æ¨è–¦)**ï¼šé«˜æ€§èƒ½çš„éµå€¼å„²å­˜ï¼Œå»£æ³›ç”¨æ–¼åˆ†æ•£å¼å¿«å–ã€‚
    
    - **SQL Server Cache**ï¼šåˆ©ç”¨ SQL Server ä½œç‚ºå¿«å–å„²å­˜ã€‚

- **å¯¦ç¾ (ä»¥ Redis ç‚ºä¾‹)**ï¼š
    
    - **å®‰è£ NuGet å¥—ä»¶**ï¼š`Microsoft.Extensions.Caching.StackExchangeRedis`
    
    - **åœ¨ `Program.cs` ä¸­è¨»å†Šæœå‹™**ï¼š
	```csharp
builder.Services.AddStackExchangeRedisCache(options =>
{
    options.Configuration = builder.Configuration.GetConnectionString("RedisCacheConnection");
    options.InstanceName = "MyApp_"; // ç‚ºå¿«å–éµæ·»åŠ å‰ç¶´
});
	```
	
	- **åœ¨ `appsettings.json` ä¸­é…ç½®é€£ç·šå­—ä¸²**ï¼š
	```csharp
{
"ConnectionStrings": {
    "RedisCacheConnection": "your_redis_server_hostname:6379,password=your_password,ssl=False,abortConnect=False"
  }
}
	```
	
	- **åœ¨éœ€è¦ä½¿ç”¨çš„é¡åˆ¥ä¸­æ³¨å…¥ `IDistributedCache`**ï¼š
	```csharp
// Services/DistributedProductService.cs
using Microsoft.Extensions.Caching.Distributed;
using System.Text.Json; // ç”¨æ–¼åºåˆ—åŒ–/ååºåˆ—åŒ–

public class DistributedProductService
{
    private readonly IDistributedCache _cache;
    private readonly ApplicationDbContext _dbContext;

    public DistributedProductService(IDistributedCache cache, ApplicationDbContext dbContext)
    {
        _cache = cache;
        _dbContext = dbContext;
    }

    public async Task<IEnumerable<Product>> GetProductsFromDistributedCacheOrDbAsync()
    {
        string cacheKey = "AllProductsDistributed";
        IEnumerable<Product> products;

        // å˜—è©¦å¾åˆ†æ•£å¼å¿«å–ä¸­ç²å–æ•¸æ“š
        string cachedProductsJson = await _cache.GetStringAsync(cacheKey);
        if (!string.IsNullOrEmpty(cachedProductsJson))
        {
            products = JsonSerializer.Deserialize<IEnumerable<Product>>(cachedProductsJson);
            return products;
        }

        // å¦‚æœå¿«å–ä¸­æ²’æœ‰ï¼Œå‰‡å¾è³‡æ–™åº«ç²å–
        products = await _dbContext.Products.ToListAsync();

        // è¨­ç½®å¿«å–é¸é …
        var cacheEntryOptions = new DistributedCacheEntryOptions()
            .SetSlidingExpiration(TimeSpan.FromMinutes(5))
            .SetAbsoluteExpiration(TimeSpan.FromHours(1));

        // å°‡æ•¸æ“šåºåˆ—åŒ–å¾Œæ·»åŠ åˆ°å¿«å–
        string productsJson = JsonSerializer.Serialize(products);
        await _cache.SetStringAsync(cacheKey, productsJson, cacheEntryOptions);

        return products;
    }

    public async Task ClearDistributedProductCache()
    {
        await _cache.RemoveAsync("AllProductsDistributed");
    }
}
	```
- **å„ªé»**ï¼š
    - è·¨å¤šå€‹ä¼ºæœå™¨å…±äº«å¿«å–ã€‚
    - æ‡‰ç”¨ç¨‹å¼é‡å•Ÿä¸æœƒæ¸…é™¤å¿«å–ã€‚
    - æä¾›æ›´å¥½çš„æ“´å±•æ€§å’Œå¯é æ€§ã€‚

- **ç¼ºé»**ï¼š
    - å¼•å…¥å¤–éƒ¨ä¾è³´ï¼Œå¢åŠ ç³»çµ±è¤‡é›œæ€§ã€‚
    - è®€å¯«å¿«å–éœ€è¦ç¶²è·¯å¾€è¿”ï¼Œå¯èƒ½æ¯”è¨˜æ†¶é«”å¿«å–ç¨æ…¢ã€‚
    - éœ€è¦è€ƒæ…®æ•¸æ“šåºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚

### 4. Tag Helper å¿«å– (Cache Tag Helper)

- **æ©Ÿåˆ¶**ï¼šç”¨æ–¼å¿«å– Razor View çš„éƒ¨åˆ†å…§å®¹ã€‚

- **é©ç”¨å ´æ™¯**ï¼šé é¢ä¸­è®ŠåŒ–é »ç‡ä¸åŒçš„å°éƒ¨ä»¶æˆ–å€å¡Šã€‚

- **å¯¦ç¾**ï¼š

    - ç¢ºä¿æ‚¨çš„å°ˆæ¡ˆå¼•ç”¨ `Microsoft.AspNetCore.Mvc.TagHelpers` (é€šå¸¸é è¨­å·²åŒ…å«)ã€‚
    
    - åœ¨ View ä¸­ä½¿ç”¨ `<cache>` æ¨™ç±¤ï¼š
```html
<h2>æœ€æ–°æ¶ˆæ¯</h2>
<cache expires-after="@TimeSpan.FromMinutes(5)" vary-by-route="categoryId">
    <p>æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š@DateTime.Now.ToString("HH:mm:ss")</p>
    <ul>
        @foreach (var news in Model.LatestNews)
        {
            <li>@news.Title</li>
        }
    </ul>
</cache>

<h2>ä¸å¿«å–çš„å…§å®¹</h2>
<p>ç•¶å‰æ™‚é–“ï¼š@DateTime.Now.ToString("HH:mm:ss")</p>
```

- **å±¬æ€§**ï¼š
    
    - `expires-after`ï¼šçµ•å°éæœŸæ™‚é–“ã€‚
    - `expires-on`ï¼šæŒ‡å®šä¸€å€‹çµ•å°çš„éæœŸæ™‚é–“é»ã€‚
    - `expires-sliding`ï¼šæ»‘å‹•éæœŸæ™‚é–“ã€‚
    - `vary-by-query`ï¼šæ ¹æ“šæŸ¥è©¢å­—ä¸²åƒæ•¸è®ŠåŒ–ã€‚
    - `vary-by-route`ï¼šæ ¹æ“šè·¯ç”±æ•¸æ“šè®ŠåŒ–ã€‚
    - `vary-by-cookie`ï¼šæ ¹æ“šæŒ‡å®š Cookie è®ŠåŒ–ã€‚
    - `vary-by-header`ï¼šæ ¹æ“šæŒ‡å®š HTTP Header è®ŠåŒ–ã€‚
    - `vary-by-user`ï¼šæ ¹æ“šç•¶å‰å·²é©—è­‰ç”¨æˆ¶è®ŠåŒ–ã€‚
    - `vary-by-param`ï¼šæ ¹æ“š Controller Action åƒæ•¸è®ŠåŒ–ã€‚
    - `priority`ï¼šå¿«å–é …çš„è¨˜æ†¶é«”å„ªå…ˆç´šã€‚
    - `enabled`ï¼šå•Ÿç”¨æˆ–ç¦ç”¨å¿«å–ã€‚

---
## æœ€ä½³å¯¦è¸èˆ‡è€ƒé‡

- **ã€Œå…ˆæª¢æŸ¥å¿«å–ï¼Œå¦‚æœæ²’æœ‰å†æŸ¥è©¢ã€æ¨¡å¼ (Cache Aside Pattern)**ï¼šé€™æ˜¯æœ€å¸¸è¦‹çš„å¿«å–ç­–ç•¥ï¼Œæ•¸æ“šå¯«å…¥æ™‚å…ˆæ›´æ–°æ•¸æ“šåº«ï¼Œå†ä½¿å¿«å–å¤±æ•ˆæˆ–æ›´æ–°å¿«å–ã€‚

- **é¸æ“‡æ­£ç¢ºçš„å¿«å–é¡å‹**ï¼š
    
    - å–®ä¼ºæœå™¨æ‡‰ç”¨ï¼šå„ªå…ˆè€ƒæ…®è¨˜æ†¶é«”å¿«å–å’ŒéŸ¿æ‡‰å¿«å–ã€‚
    
    - å¤šä¼ºæœå™¨æ‡‰ç”¨æˆ–å¾®æœå‹™ï¼šå¿…é ˆä½¿ç”¨åˆ†æ•£å¼å¿«å–ã€‚

- **å¿«å–å¤±æ•ˆç­–ç•¥ (Cache Invalidation)**ï¼š
    
    - **åŸºæ–¼æ™‚é–“**ï¼šè¨­ç½®çµ•å°éæœŸæˆ–æ»‘å‹•éæœŸã€‚
    
    - **åŸºæ–¼äº‹ä»¶/æ•¸æ“šè®Šæ›´**ï¼šç•¶å¾Œç«¯æ•¸æ“šç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œæ‰‹å‹•æ¸…é™¤æˆ–æ›´æ–°ç›¸é—œå¿«å–é …ã€‚
    
    - **åŸºæ–¼æ¨™ç±¤ (Tag)**ï¼šåœ¨ `OutputCaching` å’Œä¸€äº›åˆ†æ•£å¼å¿«å–æ¡†æ¶ä¸­ï¼Œå¯ä»¥ç‚ºå¿«å–é …æ‰“æ¨™ç±¤ï¼Œç„¶å¾Œæ‰¹é‡æ¸…é™¤ã€‚

- **é¿å…å¿«å–éæœŸé¢¨æš´ (Cache Stampede)**ï¼šç•¶å¤§é‡å¿«å–é …åŒæ™‚éæœŸæ™‚ï¼Œå¯èƒ½å°è‡´å¤§é‡è«‹æ±‚åŒæ™‚è¨ªå•å¾Œç«¯æ•¸æ“šæºï¼Œé€ æˆè² è¼‰å³°å€¼ã€‚å¯ä»¥é€šéè¨­ç½®ä¸åŒçš„éæœŸæ™‚é–“ã€é ç†±å¿«å–ã€æˆ–ä½¿ç”¨**é–å®šæ©Ÿåˆ¶**ä¾†é¿å…ã€‚

- **åºåˆ—åŒ–æˆæœ¬**ï¼šå°æ–¼åˆ†æ•£å¼å¿«å–ï¼Œæ•¸æ“šéœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚é¸æ“‡é«˜æ•ˆçš„åºåˆ—åŒ–å™¨ï¼ˆå¦‚ System.Text.Jsonï¼‰ä¸¦æ³¨æ„å°è±¡å¤§å°ã€‚

- **å¿«å–å‘½ä¸­ç‡ (Cache Hit Ratio)**ï¼šç›£æ§å¿«å–å‘½ä¸­ç‡ï¼Œé«˜å‘½ä¸­ç‡è¡¨ç¤ºå¿«å–ç­–ç•¥æœ‰æ•ˆã€‚

- **å£“ç¸®èˆ‡æ‰“åŒ…çš„è‡ªå‹•åŒ–**ï¼šåœ¨å°ˆæ¡ˆå»ºæ§‹æ™‚è‡ªå‹•åŸ·è¡Œé€™äº›ä»»å‹™ï¼Œè€Œä¸æ˜¯æ‰‹å‹•æ“ä½œã€‚

- **Web ä¼ºæœå™¨å„ªåŒ–**ï¼š
    
    - ä½¿ç”¨é«˜æ•ˆèƒ½çš„ Web ä¼ºæœå™¨ï¼Œå¦‚ Kestrel (ç›´æ¥é¢å‘ç¶²éš›ç¶²è·¯) æˆ–çµåˆ Nginx/Apache (ä½œç‚ºåå‘ä»£ç†)ã€‚
    
    - é…ç½®é©ç•¶çš„ç·šç¨‹æ± å¤§å°ã€‚

---
## ğŸ”— ç›¸é—œå¡ç‰‡

- [[011.10-CoreMVC-éåŒæ­¥ç¨‹å¼è¨­è¨ˆ (Async Await)]] (éåŒæ­¥æ˜¯æ•ˆèƒ½å„ªåŒ–çš„åŸºçŸ³)
- [[011.11-CoreMVC-æ—¥èªŒè¨˜éŒ„èˆ‡ç›£æ§ (Logging)]] (ç›£æ§æ˜¯è©•ä¼°æ•ˆèƒ½å„ªåŒ–æ•ˆæœçš„é‡è¦æ‰‹æ®µ)
- [[011.16-CoreMVC-éƒ¨ç½²èˆ‡ç¶­è­· (Deployment & Maintenance)]] (éƒ¨ç½²ç’°å¢ƒçš„å„ªåŒ–èˆ‡æ“´å±•)
- [[011.7-CoreMVC-èˆ‡è³‡æ–™åº«æ•´åˆ (EF Core)]] (è³‡æ–™åº«å„ªåŒ–èˆ‡å¿«å–ç·Šå¯†ç›¸é—œ)