---
title: ⚡ 011.11-CoreMVC-效能優化與快取
tags:
  - ASP-NET
  - Core
  - MVC
  - 效能優化
  - 快取
  - 性能調校
aliases:
  - CoreMVC 效能
  - ASP.NET Core 快取
created: 2025-07-02
updated: 2025-07-02
status: 草稿
summary: 彙整 ASP.NET Core MVC 效能優化與快取策略，涵蓋非同步程式設計、資料與回應快取、靜態資源最佳化、資料庫查詢優化與監控工具，協助打造高效能應用。
---

## ⚡ 效能優化核心原則

- **非同步程式設計**：善用 async/await 處理 I/O 密集任務（如資料庫、API），提升併發能力與伺服器吞吐量。
- **減少中介軟體（Middleware）數量**：只保留必要中介軟體，避免每個請求過多額外處理。
- **資料庫查詢優化**：減少不必要的查詢、只取所需欄位、善用索引與分頁，避免 N+1 問題。
- **壓縮與最小化靜態資源**：啟用 Gzip/Deflate 壓縮，合併及最小化 CSS/JS 檔案，減少 HTTP 請求。
- **使用 CDN**：將靜態資源（圖片、JS、CSS）分散到全球各地，降低延遲並減輕伺服器負載。
- **善用連線池（Connection Pooling）**：重複利用資料庫連線，降低建立新連線的成本。

---

## 🗂️ 快取策略總覽

| 快取類型              | 適用場景            | 實作方式與說明                               |
| :---------------- | :-------------- | :------------------------------------ |
| In-Memory Cache   | 小型/單機資料快取       | `IMemoryCache`，適合頻繁查詢且資料不常變動          |
| Distributed Cache | 多台/雲端應用         | Redis/Memcached，跨多實例共享快取資料            |
| Response Cache    | 頁面/API 結果快取     | Response Caching Middleware，針對 GET 請求 |
| Output Cache      | 控制器/Action 輸出快取 | MVC `OutputCache` 屬性，減少重複運算           |
| CDN               | 靜態資源快取          | 由第三方 CDN 服務自動處理                       |

---

## 🛠️ 快取實作範例

### 1. In-Memory Cache

```csharp
// 註冊服務  
services.AddMemoryCache();

// 使用快取  
private readonly IMemoryCache _cache;  
public MyController(IMemoryCache cache) { _cache = cache; }

public IActionResult Index()  
{  
	var data = _cache.GetOrCreate("key", entry => {  
		entry.SlidingExpiration = TimeSpan.FromMinutes(10);  
		return GetDataFromDb();  
	});  
	return View(data);  
}
```

### 2. Distributed Cache（Redis）

```csharp
// 註冊 Redis 快取  
services.AddStackExchangeRedisCache(options => {  
	options.Configuration = "localhost:6379";  
	options.InstanceName = "SampleInstance";  
});
```

### 3. Response Caching

```csharp
// 啟用 Response Caching Middleware  
app.UseResponseCaching();

// 在 Controller 或 Action 設定快取  
[ResponseCache(Duration = 60, Location = ResponseCacheLocation.Any)]  
public IActionResult Index() { ... }
```

### 4. Output Caching（MVC）

```csharp
[OutputCache(Duration = 60, VaryByParam = "none")]  
public ActionResult Index() { ... }
```

---
## 🏗️ 其他效能優化技巧

- **資料庫查詢最佳化**：只撈取必要欄位、避免過多 JOIN、善用延遲載入（Lazy Loading）。
- **Bundling & Minification**：合併並壓縮前端資源，減少請求數與檔案大小。
- **壓縮回應內容**：啟用 Gzip/Deflate，減少網路傳輸量。
- **Session 狀態最佳化**：將 Session 存於記憶體或分散式快取，提升多機環境效能。
- **關閉未用功能/模組**：移除不必要的 IIS/ASP.NET 模組，釋放資源。
- **監控與分析**：使用 Application Insights、MiniProfiler 等工具監控瓶頸並持續優化。
- **Profile 與監控**：定期分析效能數據，持續調整優化策略。

---
## ⚠️ 常見問題與建議

- **快取資料過期/同步問題**：分散式快取適合多機環境，需設計資料一致性策略。
- **快取過度**：過度快取可能導致資料非即時更新，需根據業務需求設計失效機制。
- **非同步程式設計**：I/O 密集作業應全面改為 async/await，避免阻塞伺服器。
- **資源釋放**：避免快取過多資料導致記憶體溢出，設置合適的快取大小與過期策略。

---
## 🔍 延伸學習資源

- [Microsoft Learn：ASP.NET Core 效能最佳實務][7][8]
- [C# Corner：ASP.NET Core 快取策略][2]
- [Performance Optimization Tips for ASP.NET MVC on IIS][10]
- [In-Memory Caching in ASP.NET Core][5]
- [Distributed Caching in ASP.NET Core with Redis][6]

---
## 🔗 相關卡片

- [[011.12-CoreMVC-安全性與授權 (Authentication & Authorization)]]
- [[011.14-CoreMVC-單元測試與自動化]]
- [[011.8-CoreMVC-分層架構與專案實務設計]]





