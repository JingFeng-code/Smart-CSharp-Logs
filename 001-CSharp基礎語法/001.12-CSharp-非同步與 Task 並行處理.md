---
title: ğŸ§µ 001.12-CSharp-éåŒæ­¥èˆ‡ Task ä¸¦è¡Œè™•ç†  
tags:
- C#
- éåŒæ­¥
- Task
- ä¸¦è¡Œè™•ç†
- å¤šå·¥
- async await  
aliases:
- C# Task æ•™å­¸
- C# ä¸¦è¡ŒéåŒæ­¥ 
- async å¤šä»»å‹™åŸ·è¡Œ  
created: 2025-07-24  
updated: 2025-07-24  
status: è‰ç¨¿  
summary: æœ¬ç¯‡ç­†è¨˜èªªæ˜å¦‚ä½•ä½¿ç”¨ C# çš„ `Task` æ­é… `async/await` åŸ·è¡Œå¤šå€‹éåŒæ­¥å·¥ä½œï¼ˆä¸¦è¡Œè™•ç†ï¼‰ï¼Œå”åŠ©ä½ æœ‰æ•ˆæå‡ç¨‹å¼æ•ˆèƒ½ï¼Œä¸¦é€é `WhenAll`ã€`WhenAny` ç­‰æ–¹å¼å¯¦ä½œå¯¦ç”¨çš„å¤šä»»å‹™å ´æ™¯ã€‚
---

## ğŸ“˜ æœ¬ç¯‡é‡é»ç´¢å¼•

- ä¸¦è¡Œè™•ç†çš„åŸºæœ¬è§€å¿µï¼ˆConcurrency vs Parallelismï¼‰

- åŒæ™‚å•Ÿå‹•å¤šå€‹éåŒæ­¥ä»»å‹™çš„æ–¹æ³•

- ä½¿ç”¨ `Task.WhenAll` èˆ‡ `Task.WhenAny` çš„å¯¦ä¾‹

- ç®¡ç†éåŒæ­¥ä»»å‹™é›†åˆèˆ‡çµæœåˆä½µ

- éŒ¯èª¤è™•ç†èˆ‡æ•ˆèƒ½è€ƒé‡

---
## 1ï¸âƒ£ ä»€éº¼æ˜¯ä¸¦è¡Œè™•ç†ï¼ˆConcurrencyï¼‰ï¼Ÿ

- âœ… **éåŒæ­¥ï¼ˆAsynchronousï¼‰**ï¼šç¨‹å¼ä¸æœƒé˜»å¡ç­‰å¾…ï¼Œå¯ä»¥é€²è¡Œå…¶ä»–ä»»å‹™

- âœ… **ä¸¦è¡Œï¼ˆConcurrentï¼‰**ï¼šå¤šå€‹éåŒæ­¥ä»»å‹™å¯åŒæ™‚é€²è¡Œï¼ˆä¾‹å¦‚åŒæ™‚å‘¼å«å¤šå€‹ APIï¼‰


ğŸ“Œ å¯¦å‹™æƒ…å¢ƒï¼š

- åŒæ™‚æŸ¥è©¢å…©å€‹è³‡æ–™åº«

- åŒæ™‚ä¸‹è¼‰å¤šå¼µåœ–ç‰‡

- ä¸¦è¡ŒåŸ·è¡Œ API å‘¼å«èˆ‡è¨ˆç®—å·¥ä½œ

---
## 2ï¸âƒ£ åŒæ™‚å•Ÿå‹•å¤šå€‹éåŒæ­¥ä»»å‹™

```csharp
var task1 = GetDataFromApiAsync();
var task2 = GetDataFromDbAsync();
var task3 = DoCalculationAsync();
```

- æ­¤æ™‚ä¸‰å€‹å·¥ä½œã€Œå¹¾ä¹åŒæ™‚ã€å•Ÿå‹•
- ä½†ä»éœ€ä½¿ç”¨ `await` ç­‰å¾…å®Œæˆï¼ˆè¦‹ä¸‹ç¯€ï¼‰

---
## 3ï¸âƒ£ ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆï¼š`Task.WhenAll`

```csharp
await Task.WhenAll(task1, task2, task3);
Console.WriteLine("ä¸‰é …ä»»å‹™çš†å·²å®Œæˆ");
```

- æ‰€æœ‰ä»»å‹™å®Œæˆå¾Œæ‰æœƒç¹¼çºŒåŸ·è¡Œä¸‹å»

- è‹¥ä»»ä¸€ä»»å‹™æ‹‹å‡ºä¾‹å¤–ï¼Œæ•´é«”æœƒé€²å…¥ catch å€å¡Š

ğŸ”§ çµæœå–å›ç¯„ä¾‹ï¼ˆæœ‰å›å‚³å€¼ï¼‰ï¼š

```csharp
var t1 = GetNameAsync();
var t2 = GetAgeAsync();
var results = await Task.WhenAll(t1, t2);
Console.WriteLine($"å§“åï¼š{results[0]}, å¹´é½¡ï¼š{results[1]}");
```

---
## 4ï¸âƒ£ åªç­‰å¾…ç¬¬ä¸€å€‹å®Œæˆï¼š`Task.WhenAny`

```csharp
var tasks = new List<Task<string>>
{
    SlowSource1Async(),
    FastSource2Async(),
    FallbackSourceAsync()
};

var completed = await Task.WhenAny(tasks);
Console.WriteLine($"æœ€å…ˆå®Œæˆçš„çµæœï¼š{await completed}");
```

ğŸ“Œ é©ç”¨æ–¼ï¼šã€Œèª°å…ˆå®Œæˆå°±ç”¨èª°çš„çµæœã€çš„æƒ…å¢ƒ  
ä¾‹å¦‚å¤šå€‹å‚™æ´ APIã€ä¼ºæœå™¨è¼ªè©¢ç­‰

---
## 5ï¸âƒ£ Task çµæœæ•´åˆèˆ‡éŒ¯èª¤è™•ç†

```csharp
try
{
    var task1 = GetFromAAsync();
    var task2 = GetFromBAsync();
    var result = await Task.WhenAll(task1, task2);

    foreach (var r in result)
        Console.WriteLine($"è³‡æ–™ï¼š{r}");
}
catch (Exception ex)
{
    Console.WriteLine($"éŒ¯èª¤ï¼š{ex.Message}");
}
```

âœ… ä½ å¯ä»¥ç”¨ try-catch åŒ…è£¹æ•´é«”ï¼Œæˆ–å–®ç¨è™•ç†æ¯å€‹ task çš„éŒ¯èª¤ï¼ˆé€²éšæŠ€å·§ï¼‰

---
## 6ï¸âƒ£ Task ä¸¦è¡Œå¯¦å‹™å°æŠ€å·§

|æŠ€å·§ / å•é¡Œ|å»ºè­°åšæ³•|
|---|---|
|éœ€è¦æ’åºåŸ·è¡Œï¼Ÿ|ä¸é©åˆç”¨ä¸¦è¡Œï¼Œè«‹ç”¨ `await` ä¾åºå¯«|
|ä¸åœ¨ä¹é †åºä½†æƒ³åŠ é€Ÿ|ç”¨ `Task.WhenAll`|
|æƒ³æ—©é»å¾—åˆ°ä¸€å€‹å°±å¥½|ç”¨ `Task.WhenAny`|
|é ˆé™åˆ¶åŒæ™‚åŸ·è¡Œæ•¸é‡|ä½¿ç”¨ `SemaphoreSlim`ï¼ˆé€²éšï¼‰|
|æ¯æ¬¡éƒ½ await æ‰åŸ·è¡Œï¼Ÿ|è¦ã€Œå…ˆå®£å‘Š task å† awaitã€æ‰èƒ½ä¸¦è¡Œ|

---
## âœ… å°çµ

- `Task` å¯è®“å¤šå€‹éåŒæ­¥å·¥ä½œã€ŒåŒæ™‚ã€é€²è¡Œï¼Œæå‡æ•ˆç‡

- ä½¿ç”¨ `Task.WhenAll` ç­‰å¾…å…¨éƒ¨å®Œæˆï¼Œé©åˆæ”¶é›†æ‰€æœ‰çµæœ

- ä½¿ç”¨ `Task.WhenAny` ç­‰å¾…æœ€å¿«å®Œæˆçš„ä»»å‹™

- çµæœç‚ºé™£åˆ—ï¼Œéœ€è‡ªè¡Œå–ç”¨èˆ‡è™•ç†éŒ¯èª¤

- æ­é… `async/await` æ˜¯ç¾ä»£ C# çš„åŸºæœ¬èƒ½åŠ›ï¼

---

## ğŸ”— å»¶ä¼¸é–±è®€

- [[001.11-CSharp-éåŒæ­¥ç¨‹å¼è¨­è¨ˆï¼ˆasync_awaitï¼‰]]
- [Task.WhenAll æ–‡ä»¶](https://learn.microsoft.com/zh-tw/dotnet/api/system.threading.tasks.task.whenall)
- [éåŒæ­¥æœ€ä½³å¯¦å‹™æŒ‡å—](https://learn.microsoft.com/zh-tw/dotnet/standard/asynchronous-programming-patterns/)