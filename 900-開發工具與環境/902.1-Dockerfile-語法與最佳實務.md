---
title: ğŸ“„ 902.1-Dockerfile-èªæ³•èˆ‡æœ€ä½³å¯¦å‹™
tags:
  - Docker
  - Dockerfile
  - å®¹å™¨åŒ–
  - æ˜ åƒå»ºæ§‹
aliases:
  - Dockerfile æ•™å­¸
  - Dockerfile èªæ³•
  - Dockerfile Best Practices
created: 2025-07-23
updated: 2025-07-23
status: è‰ç¨¿
summary: æœ¬ç­†è¨˜ä»‹ç´¹ Dockerfile çš„åŸºæœ¬èªæ³•ã€å»ºæ§‹æµç¨‹èˆ‡æœ€ä½³å¯¦å‹™ï¼Œå”åŠ©é–‹ç™¼è€…æ’°å¯«é«˜æ•ˆã€å®‰å…¨ã€å¯ç¶­è­·çš„å®¹å™¨æ˜ åƒæª”å®šç¾©ã€‚
---
## ğŸ§± Dockerfile æ˜¯ä»€éº¼ï¼Ÿ

Dockerfile æ˜¯ä¸€ç¨®æŒ‡ä»¤è…³æœ¬ï¼Œç”¨ä¾†å®šç¾©å¦‚ä½•å»ºç«‹ä¸€å€‹ Docker æ˜ åƒæª”ã€‚æ¯å€‹æŒ‡ä»¤éƒ½æœƒç”¢ç”Ÿä¸€å±¤ï¼ˆlayerï¼‰ï¼Œé€™äº›å±¤å…±åŒæ§‹æˆæœ€çµ‚æ˜ åƒæª”ã€‚

æ’°å¯« Dockerfile å¯è®“æ‡‰ç”¨åœ¨ä¸åŒç’°å¢ƒä¸­ç¶­æŒä¸€è‡´æ€§èˆ‡å¯é‡ç¾æ€§ã€‚

---

## ğŸ”¤ å¸¸ç”¨æŒ‡ä»¤èªæ³•

|æŒ‡ä»¤|èªªæ˜|
|---|---|
|`FROM`|æŒ‡å®šåŸºç¤æ˜ åƒï¼Œä¾‹å¦‚ `python:3.11-slim`|
|`RUN`|åŸ·è¡ŒæŒ‡ä»¤ï¼Œä¾‹å¦‚å®‰è£å¥—ä»¶ `RUN apt update && apt install -y curl`|
|`COPY` / `ADD`|å°‡æª”æ¡ˆåŠ å…¥æ˜ åƒä¸­ï¼ˆ`ADD` æ”¯æ´å£“ç¸®èˆ‡ URLï¼‰|
|`WORKDIR`|è¨­å®šå®¹å™¨å…§å·¥ä½œç›®éŒ„|
|`ENV`|è¨­å®šç’°å¢ƒè®Šæ•¸|
|`CMD`|å®¹å™¨å•Ÿå‹•æ™‚åŸ·è¡Œçš„é è¨­æŒ‡ä»¤ï¼ˆå¯è¢«è¦†è“‹ï¼‰|
|`ENTRYPOINT`|å®¹å™¨åŸ·è¡Œçš„ä¸»è¦é€²å…¥é»ï¼ˆä¸æ˜“è¢«è¦†è“‹ï¼‰|
|`EXPOSE`|å®£å‘Šå®¹å™¨æœƒä½¿ç”¨çš„ Port|
|`VOLUME`|å®£å‘Šè³‡æ–™å·ï¼ˆé€šå¸¸é…åˆå¤–éƒ¨æ›è¼‰ï¼‰|

---
## âœ… æ’°å¯«æœ€ä½³å¯¦å‹™

### 1ï¸âƒ£ é¿å…å¤šé¤˜å±¤ç´šèˆ‡æŒ‡ä»¤åˆ†é–‹

```dockerfile
# âŒ æ¯å€‹ RUN ç”¢ç”Ÿä¸€å±¤
RUN apt update
RUN apt install -y git

# âœ… åˆä½µæˆä¸€å±¤ï¼Œæ¸›å°‘æ˜ åƒé«”ç©
RUN apt update && apt install -y git
```

### 2ï¸âƒ£ é¸æ“‡é©åˆçš„ base image

- å°å‹æ˜ åƒæ¨è–¦ä½¿ç”¨ `alpine`ï¼ˆä½†éœ€æ³¨æ„å¥—ä»¶ç›¸å®¹ï¼‰

- å®‰å…¨æ€§é«˜ï¼šä½¿ç”¨å®˜æ–¹ image æˆ–æŒ‡å®šç‰ˆæœ¬ tagï¼ˆé¿å… `latest`ï¼‰

### 3ï¸âƒ£ å–„ç”¨ `.dockerignore`

å¿½ç•¥ä¸å¿…è¦çš„æª”æ¡ˆé€²å…¥æ˜ åƒæª”ï¼Œå¦‚ï¼š

```bash
node_modules
.git
*.log
.env
```

### 4ï¸âƒ£ è¨­å®š ENTRYPOINT + CMD å€åˆ†åƒæ•¸

```dockerfile
ENTRYPOINT ["python3", "main.py"]
CMD ["--debug"]  # å¯è¢« docker run å‚³å…¥åƒæ•¸è¦†è“‹
```

### 5ï¸âƒ£ å–„ç”¨ multi-stage buildï¼ˆå¤šéšæ®µå»ºæ§‹ï¼‰

å¯æœ‰æ•ˆæ¸›å°‘æœ€çµ‚æ˜ åƒé«”ç©ï¼Œå¸¸ç”¨æ–¼ Node.jsã€Pythonã€Go æ‡‰ç”¨ã€‚

```dockerfile
# ç¬¬ä¸€éšæ®µï¼šå»ºç½®
FROM node:18 as builder
WORKDIR /app
COPY . .
RUN npm install && npm run build

# ç¬¬äºŒéšæ®µï¼šéƒ¨ç½²æ˜ åƒ
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

---

## ğŸ§ª å¯¦ç”¨å°æŠ€å·§

- ä½¿ç”¨ `ARG` å®šç¾©å»ºæ§‹æ™‚åƒæ•¸ï¼ˆå¦‚ç‰ˆæœ¬ï¼‰

- æ­é… `LABEL` å¢åŠ æ˜ åƒè³‡è¨Š

- `HEALTHCHECK` å¢åŠ å®¹å™¨ç›£æ§èƒ½åŠ›

- æ­é… `docker history` æŸ¥çœ‹æ˜ åƒå»ºæ§‹å±¤ç´š

---
## ğŸ“Œ ç¯„ä¾‹ï¼šPython Flask API æ˜ åƒæª”

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 5000
CMD ["python", "app.py"]
```

---

## ğŸ”— å»¶ä¼¸é–±è®€

- [Dockerfile å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/engine/reference/builder/)
- [Best practices for writing Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
- [[902-Docker-ç¸½è¦½]]
- [[902.2-docker-compose-é€²éšç”¨æ³•]]