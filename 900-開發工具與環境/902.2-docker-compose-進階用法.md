---
title: ğŸ§© 902.2-docker-compose-é€²éšç”¨æ³•
tags:
  - Docker
  - docker-compose
  - å®¹å™¨å”ä½œ
  - é–‹ç™¼å·¥å…·
aliases:
  - docker-compose é€²éšæŠ€å·§
  - å¤šå®¹å™¨å”åŒé‹ä½œ
created: 2025-07-23
updated: 2025-07-23
status: è‰ç¨¿
summary: æœ¬ç­†è¨˜ä»‹ç´¹ docker-compose çš„é€²éšç”¨æ³•ï¼Œæ¶µè“‹å¤šæœå‹™å”ä½œã€ç’°å¢ƒè®Šæ•¸ã€å»ºæ§‹æµç¨‹ã€Volume æ›è¼‰ã€ç¶²è·¯è¨­å®šèˆ‡å¯¦å‹™ç¯„ä¾‹ã€‚
---
## ğŸ§© docker-compose æ˜¯ä»€éº¼ï¼Ÿ

`docker-compose` æ˜¯ç”¨ä¾†å®šç¾©ä¸¦ç®¡ç†å¤šå€‹ Docker å®¹å™¨çš„å·¥å…·ï¼Œé€é `docker-compose.yml` æ–‡ä»¶ä¸€æ¬¡å•Ÿå‹•æ•´çµ„æ‡‰ç”¨ç¨‹å¼æœå‹™ï¼Œå¸¸è¦‹æ–¼å¾®æœå‹™æˆ–å‰å¾Œç«¯æ•´åˆé–‹ç™¼å ´æ™¯ã€‚

---

## ğŸ“„ YAML æª”åŸºæœ¬çµæ§‹

```yaml
version: "3.9"
services:
  web:
    build: .
    ports:
      - "3000:3000"
  api:
    image: my-api:latest
    ports:
      - "5000:5000"
    depends_on:
      - db
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
```

---
## ğŸ”§ å¸¸ç”¨é€²éšè¨­å®šé …ç›®

### ğŸ” depends_on

æŒ‡å®šä¾è³´é †åºï¼ˆä½†ä¸ç­‰æ–¼å•Ÿå‹•å°±ç·’ï¼‰ï¼Œå¯æ­é… healthcheckã€‚

```yaml
depends_on:
  - db
```

### ğŸŒ networks

å®šç¾©è™›æ“¬ç¶²è·¯é€£æ¥ï¼Œè®“å®¹å™¨é–“èƒ½ä»¥æœå‹™åç¨±æºé€šï¼š

```yaml
networks:
  backend:
    driver: bridge

services:
  api:
    networks:
      - backend
```

### ğŸ’¾ volumes

æ›è¼‰è³‡æ–™å·è®“è³‡æ–™æŒä¹…åŒ–æˆ–èˆ‡ä¸»æ©ŸåŒæ­¥ï¼š

```yaml
volumes:
  db_data:

services:
  db:
    volumes:
      - db_data:/var/lib/postgresql/data
```

### ğŸ“¦ build èˆ‡ context

ç”¨ä¾†å»ºæ§‹æ˜ åƒæª”ï¼ŒæŒ‡å®š Dockerfile ä½ç½®èˆ‡ä¸Šä¸‹æ–‡ï¼š

```yaml
build:
  context: ./frontend
  dockerfile: Dockerfile.dev
```

## âš™ï¸ æ­é… `.env` ä½¿ç”¨ç’°å¢ƒè®Šæ•¸

å»ºç«‹ `.env`ï¼š

```ini
POSTGRES_USER=myuser
POSTGRES_PASSWORD=secret
```

åœ¨ compose æª”ä¸­ä½¿ç”¨ï¼š

```yaml
environment:
  - POSTGRES_USER=${POSTGRES_USER}
```

---
## ğŸ©º åŠ å…¥ healthcheck å¥åº·æª¢æŸ¥

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
  interval: 30s
  timeout: 10s
  retries: 5
```

---
## ğŸ›  å¸¸ç”¨æŒ‡ä»¤

|æŒ‡ä»¤|èªªæ˜|
|---|---|
|`docker-compose up -d`|å•Ÿå‹•æ‰€æœ‰æœå‹™ï¼ˆèƒŒæ™¯æ¨¡å¼ï¼‰|
|`docker-compose down`|åœæ­¢ä¸¦ç§»é™¤å®¹å™¨èˆ‡ç¶²è·¯|
|`docker-compose build`|æ‰‹å‹•å»ºæ§‹æ˜ åƒ|
|`docker-compose logs -f`|ç›£çœ‹æ—¥èªŒè¼¸å‡º|
|`docker-compose exec api bash`|é€²å…¥æŒ‡å®šå®¹å™¨äº’å‹•|

---
## ğŸ” ç¯„ä¾‹ï¼šå‰å¾Œç«¯ + è³‡æ–™åº«æ•´åˆ

```yaml
version: "3.9"
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    depends_on:
      - db
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: secret
    volumes:
      - pg_data:/var/lib/postgresql/data

volumes:
  pg_data:
```

## ğŸ”— å»¶ä¼¸é–±è®€èˆ‡ç›¸é—œç­†è¨˜

- [[902-Docker-ç¸½è¦½]]
- [[902.1-Dockerfile-èªæ³•èˆ‡æœ€ä½³å¯¦å‹™]]
- [docker-compose å®˜æ–¹æ–‡ä»¶](https://docs.docker.com/compose/)
- [Compose file reference](https://docs.docker.com/compose/compose-file/)