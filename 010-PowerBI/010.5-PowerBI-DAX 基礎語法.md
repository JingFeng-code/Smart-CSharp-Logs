---
title: 🧮 010.5-PowerBI-DAX 基礎語法
tags:
  - PowerBI
  - DAX
  - 資料分析
  - BI工具
aliases:
  - Power BI DAX
  - DAX 基礎
created: 2025-07-08
updated: 2025-07-08
status: 完成
summary: 介紹 Power BI DAX 的基本概念、語法結構、常用函數與實用範例，協助建立自訂計算與進階分析能力。
---

## 🧮 什麼是 DAX？資料分析的超級工具！

想像 Power BI 像一個廚房，把數據整理好（資料建模）就像是把食材都處理乾淨。但光有食材不夠，你還需要「食譜」來烹煮出美味的料理！

**DAX（Data Analysis Expressions）** 就是 Power BI、Power Pivot 和 SQL Server Analysis Services 專用的「食譜語言」。它不是用來清洗資料或建立模型的，而是用來**建立自訂計算、度量值（Measure）、計算欄位（Calculated Column）和計算表格（Calculated Table）** 的強大工具。

DAX 讓使用者能結合各種函數、運算子和常數，根據資料模型進行**動態運算**，從而產生新的洞察和指標。它能將原始數據轉化為有意義的商業資訊，例如計算總銷售額、利潤率、去年同期增長率等等。

---

## 📝 DAX 語法結構：像寫方程式一樣清晰

DAX 的語法結構直觀且有邏輯性，理解這些基本規則是撰寫有效公式的基礎：

* **公式開頭**：每個 DAX 公式都必須以等號 `=` 開始。
* **名稱定義**：在等號前面，需要定義這個計算的名稱。對於**度量值**，這是度量值的名稱；對於**計算欄位**，這是新欄位的名稱；對於**計算表**，這是新表的名稱。
* **函數與運算子**：DAX 擁有多種內建函數，涵蓋數學、邏輯、文字、日期、篩選等等。這些函數可以多層嵌套，實現複雜的運算。
* **欄位/表格參照**：
    * **表格名稱**：當引用表格時，使用單引號 `'` 包裹，例如 `'銷售表'`。
    * **欄位名稱**：當引用欄位時，使用中括號 `[]` 包裹，例如 `[金額]`。
    * **完整寫法**：為了清晰起見，通常會同時引用表名和欄位名，如 `'銷售表'[金額]`。
* **變數宣告 (`VAR` / `RETURN`)**：使用 `VAR` 關鍵字可以定義一個或多個變數，用於儲存中間計算結果。最後用 `RETURN` 關鍵字返回最終結果。這能顯著提升公式的**可讀性、維護性，並改善效能**（避免重複計算）。

**DAX 語法範例：**

```dax
// 定義一個度量值：計算總銷售額
總銷售額 = SUM('銷售表'[金額])

// 定義一個度量值：計算利潤率 (使用 DIVIDE 函數處理除數為零的情況)
利潤率 = DIVIDE([利潤], [銷售額], 0) // 第三個參數是當除數為零時的回傳值

// 定義一個度量值：計算銷售成長率，並運用變數
銷售成長率 =
VAR 去年銷售額 = CALCULATE([總銷售額], SAMEPERIODLASTYEAR('日期表'[日期]))
VAR 今年銷售額 = [總銷售額]
RETURN DIVIDE(今年銷售額 - 去年銷售額, 去年銷售額, 0)
```

---
## 🔑 常用 DAX 函數分類
DAX 函數庫非常龐大，熟悉常用函數能大幅提升資料分析能力。以下是一些主要分類：

|類型|代表函數|說明與用途|
|---|---|---|
|**聚合函數**|`SUM`, `AVERAGE`, `COUNT`, `MIN`, `MAX`|對數值欄位進行加總、平均、計數、最大/最小值等統計運算。|
|**迭代函數 (X 函數)**|`SUMX`, `AVERAGEX`, `COUNTX`|針對表格的每一列進行運算後，再執行聚合。這是理解 DAX **上下文轉換**的關鍵。|
|**篩選函數**|`FILTER`, `CALCULATE`, `ALL`, `ALLSELECTED`|動態修改計算的篩選上下文，是 DAX 最強大的功能之一。|
|**邏輯函數**|`IF`, `SWITCH`, `AND`, `OR`|執行條件判斷，根據不同條件返回不同結果。|
|**文字函數**|`CONCATENATE`, `LEFT`, `RIGHT`, `SEARCH`, `FORMAT`|處理和操作文本字串。|
|**日期/時間函數**|`TODAY`, `YEAR`, `MONTH`, `DATEADD`, `SAMEPERIODLASTYEAR`, `TOTALYTD`|執行日期運算、期間比較和時間智能分析。|
|**關係函數**|`RELATED`, `RELATEDTABLE`|在不同表格之間建立或使用現有關係來檢索資料。|
|**表值函數**|`VALUES`, `DISTINCT`, `SUMMARIZE`|返回一個表格，常用於作為其他函數的輸入參數。|

---
## 🛠️ 常見 DAX 應用範例

DAX 主要用於以下兩種核心計算：

1. **建立度量值（Measure）**
    - **定義**：度量值是在報表中使用時才進行計算的動態公式。它們不會儲存到資料模型中，而是根據報表的篩選上下文即時產生結果。
    - **用途**：適用於需要聚合數據的場景，例如總銷售額、平均利潤、活躍用戶數等。
    - **範例**：
		`總銷售額 = SUM('銷售表'[金額])`
		`訂單數量 = COUNTROWS('銷售表')`

2. **建立計算欄位（Calculated Column）**
	- **定義**：計算欄位是在資料模型中新增加的欄位，其值在資料載入時或模型刷新時計算並儲存起來。
	- **用途**：適用於需要逐列計算的場景，例如根據單價和數量計算每行的銷售小計、根據出生日期計算年齡等。
	- **範例**：
		`// 在 '產品表' 中新增計算欄位`
		`庫存價值 = '產品表'[售價] * '產品表'[庫存量]`
	**DAX 進階應用範例：**
		- **條件判斷**  
			`銷售等級 = IF([總銷售額] > 100000, "高", "一般")`
		- **動態篩選與進階計算** 
			`// 計算去年同期銷售額：改變篩選上下文到去年同期`
			`去年同期銷售 = CALCULATE([總銷售額], SAMEPERIODLASTYEAR('日期表'[日期]))`
			`// 計算特定產品的銷售額：篩選產品名稱為 "筆記型電腦"`
			`筆電銷售額 = CALCULATE([總銷售額], '產品表'[產品名稱] = "筆記型電腦")`

---
## ⚠️ 實務注意事項：避開 DAX 的小陷阱

撰寫 DAX 公式時，請注意以下幾點以確保效率與正確性：

- **理解度量值與計算欄位的差異**：
    - **計算時機**：度量值是**即時計算**，受報表互動影響；計算欄位是**模型刷新時計算並儲存**。
    
    - **儲存空間**：度量值不佔用儲存空間；計算欄位會增加模型大小，可能影響效能。
    
    - **選擇原則**：優先使用**度量值**。只有當需要將結果作為視覺化圖表的軸、篩選器，或在關係中扮演一對多關係的「一」方時，才考慮使用計算欄位。

- **DAX 的「上下文」概念**：這是 DAX 最難理解但也最重要的概念。DAX 公式在兩種主要上下文下評估：
    - **行上下文 (Row Context)**：在計算欄位中，公式會針對每一行進行評估。迭代函數（如 `SUMX`）也會在行上下文下操作。
    
    - **篩選上下文 (Filter Context)**：由報表的視覺化、切片器、篩選器等施加的篩選條件。`CALCULATE` 函數可以修改篩選上下文。 理解這兩種上下文如何互動，是掌握 DAX 進階應用的關鍵。

- **無法直接引用單一儲存格**：DAX 函數總是針對**整個欄位或表格**進行運算，不像 Excel 可以直接引用 A1 儲存格。所有操作都是基於列或篩選後的表格進行。

- **複雜公式多用變數 (`VAR`)**：對於較長的或重複使用的表達式，使用 `VAR` 可以大幅提升公式的可讀性，並因為避免重複計算而改善效能。

- **時間智慧函數需要日期表**：若要使用 `SAMEPERIODLASTYEAR`, `TOTALYTD` 等時間智慧函數，模型中必須有一個**獨立的日期表**，且日期欄位應為**連續不間斷**，並標記為**日期資料表**。

---
## 🔍 學習資源

- [Microsoft Learn：DAX 基本概念與語法說明](https://learn.microsoft.com/zh-tw/dax/dax-overview)
- [DAX 函式參考總表](https://learn.microsoft.com/zh-tw/dax/dax-function-reference)
- [DAX Guide](https://dax.guide/)：一個非常實用的 DAX 函數查詢網站。

---
## 🔗 相關卡片

- [[010.4-PowerBI-視覺化圖表應用]]
- [[010.6-PowerBI-互動功能與篩選器]]
- [[010.7-PowerBI-發佈與分享報表]]
