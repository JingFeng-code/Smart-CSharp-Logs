---
title: ğŸ”„ ADO.NET - äº¤æ˜“è™•ç†
tags:
  - ADO-NET
  - SQL
  - Transaction
  - SqlTransaction
  - CSharp
  - è³‡æ–™ä¸€è‡´æ€§
aliases:
  - ADO.NET Transaction
  - äº¤æ˜“æ§åˆ¶
  - è³‡æ–™ä¸€è‡´æ€§è™•ç†
created: 2025-06-23
updated: 2025-06-23
status: å®Œæˆ
summary: ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ ADO.NET ä¸­çš„ SqlTransaction ç®¡ç†è³‡æ–™åº«äº¤æ˜“ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§èˆ‡éŒ¯èª¤å›æ»¾è™•ç†ã€‚
---

# ğŸ”„ ADO.NET - äº¤æ˜“è™•ç†

>äº¤æ˜“ï¼ˆTransactionï¼‰å¯ç¢ºä¿å¤šå€‹è³‡æ–™æ“ä½œ **è¦å˜›å…¨éƒ¨æˆåŠŸã€è¦å˜›å…¨éƒ¨å¤±æ•—**ï¼Œå¸¸æ‡‰ç”¨æ–¼é‡‘èè½‰å¸³ã€è¨‚å–®è™•ç†ç­‰éœ€è¦è³‡æ–™ä¸€è‡´æ€§çš„å ´æ™¯ã€‚

---

## 1ï¸âƒ£ ä½¿ç”¨ `SqlTransaction` åŸºæœ¬èªæ³•

```csharp
string connStr = "Data Source=.;Initial Catalog=MyDB;Integrated Security=True;";
using(SqlConnection conn = new SqlConnection(connStr))
{
    conn.Open();
    SqlTransaction transaction = conn.BeginTransaction();

    try
    {
        SqlCommand cmd1 = new SqlCommand("UPDATE Members SET Balance = Balance - 100 WHERE Id = 1", conn, transaction);
        SqlCommand cmd2 = new SqlCommand("UPDATE Members SET Balance = Balance + 100 WHERE Id = 2", conn, transaction);

        cmd1.ExecuteNonQuery();
        cmd2.ExecuteNonQuery();

        transaction.Commit(); // æäº¤äº¤æ˜“
        Console.WriteLine("äº¤æ˜“å®Œæˆï¼");
    }
    catch (Exception ex)
    {
        transaction.Rollback(); // å›æ»¾äº¤æ˜“
        Console.WriteLine("äº¤æ˜“å¤±æ•—ï¼š" + ex.Message);
    }
}
```

---
## 2ï¸âƒ£ æ³¨æ„äº‹é …

| é …ç›®                               | èªªæ˜          |
| -------------------------------- | ----------- |
| é–‹å•Ÿäº¤æ˜“å‰è¦å…ˆ `conn.Open()`            | å¦å‰‡ç„¡æ³•å•Ÿå‹•äº¤æ˜“ç‰©ä»¶  |
| `Commit()`                       | ç¢ºèªåŸ·è¡Œæ‰€æœ‰æ“ä½œ    |
| `Rollback()`                     | ç™¼ç”ŸéŒ¯èª¤å‰‡å–æ¶ˆæ‰€æœ‰æ›´å‹• |
| æ‰€æœ‰ SqlCommand å¿…é ˆæŒ‡å®š `transaction` | æ‰æœƒåœ¨äº¤æ˜“å…§åŸ·è¡Œ    |
|                                  |             |

---
## âœ… ä½¿ç”¨å ´æ™¯

- è³‡æ–™ä¸€è‡´æ€§è¦æ±‚é«˜çš„æ“ä½œï¼ˆå¦‚é‡‘èã€åº«å­˜ï¼‰
    
- å¤šç­†è³‡æ–™åŒæ™‚æ›´æ–°æ™‚é¿å…éƒ¨åˆ†æˆåŠŸ